<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intesa Vincente</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        :root {
            --primary: #1a237e;
            --secondary: #d32f2f;
            --accent: #ffab00;
            --success: #4caf50;
            --danger: #f44336;
            --info: #2196f3;
            --warning: #ff9800;
            --dark: #0d1426;
            --light: #f8f9fa;
            --gold: #ffd700;
            --silver: #c0c0c0;
            --bronze: #cd7f32;
        }
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow: auto;
            font-size: 14px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        header {
            text-align: center;
            margin-bottom: 10px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            border: 2px solid var(--accent);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }
        h1 {
            font-size: 1.8rem;
            color: var(--primary);
            margin-bottom: 8px;
            font-weight: 800;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
        }
        .subtitle {
            font-size: 0.9rem;
            color: var(--secondary);
            font-weight: 600;
        }
        .game-layout {
            display: flex;
            gap: 10px;
            flex: 1;
            min-height: 400px;
        }
        .team-sidebar {
            flex: 0 0 200px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 15px;
            border: 2px solid var(--primary);
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .team-sidebar.active {
            border-color: var(--success);
            background: rgba(76, 175, 80, 0.1);
            transform: scale(1.02);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.25);
        }
        .team-name {
            font-size: 1.1rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 12px;
            color: var(--primary);
            padding: 12px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 8px;
            border: 2px solid var(--accent);
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }
        .team-sidebar.active .team-name {
            background: linear-gradient(135deg, var(--success), #2e7d32);
            color: white;
        }
        .score {
            font-size: 1.6rem;
            font-weight: 700;
            text-align: center;
            margin: 12px 0;
            padding: 12px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        .team-sidebar.active .score {
            border-color: var(--success);
            color: var(--success);
        }
        .money-display {
            font-size: 1rem;
            font-weight: 600;
            text-align: center;
            margin: 8px 0;
            padding: 10px;
            background: linear-gradient(135deg, var(--gold), var(--warning));
            border-radius: 8px;
            border: 2px solid var(--accent);
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }
        .players-list {
            flex: 1;
            overflow-y: auto;
            background: rgba(248, 249, 250, 0.8);
            border-radius: 8px;
            padding: 12px;
            border: 2px solid var(--info);
            font-size: 0.85rem;
        }
        .player-item {
            padding: 10px;
            margin: 6px 0;
            background: white;
            border-radius: 6px;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 500;
            border: 2px solid var(--info);
            transition: all 0.3s ease;
        }
        .player-item:hover {
            background: var(--info);
            color: white;
            transform: translateY(-2px);
        }
        .game-center {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid var(--accent);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .timer-section {
            text-align: center;
            margin-bottom: 15px;
        }
        .timer {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--danger);
            background: linear-gradient(135deg, #fff, #f0f0f0);
            padding: 15px 30px;
            border-radius: 12px;
            border: 3px solid var(--danger);
            margin: 12px 0;
            display: inline-flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 4px 15px rgba(244, 67, 54, 0.25);
        }
        .seconds-label {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--danger);
        }
        .word-display {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 12px;
            margin: 15px 0;
            border: 3px solid var(--primary);
            min-height: 150px;
            box-shadow: inset 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        .word {
            font-size: 2.8rem;
            font-weight: 800;
            color: white;
            text-align: center;
            padding: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        .word.hidden {
            color: transparent;
            text-shadow: none;
        }
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        button {
            padding: 12px 20px;
            font-size: 0.9rem;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
        }
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .start-btn {
            background: linear-gradient(135deg, var(--success), #2e7d32);
            color: white;
        }
        .stop-btn {
            background: linear-gradient(135deg, var(--danger), #c62828);
            color: white;
        }
        .next-btn {
            background: linear-gradient(135deg, var(--info), #1565c0);
            color: white;
        }
        .raddoppio-btn {
            background: linear-gradient(135deg, #9c27b0, #6a1b9a);
            color: white;
        }
        .correct-btn {
            background: linear-gradient(135deg, var(--success), #2e7d32);
            color: white;
            padding: 10px 20px;
        }
        .wrong-btn {
            background: linear-gradient(135deg, var(--danger), #c62828);
            color: white;
            padding: 10px 20px;
        }
        .answer-controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
            justify-content: center;
            margin-top: 15px;
            align-items: center;
        }
        .hidden {
            display: none !important;
        }
        .stats-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        .stat-box {
            text-align: center;
            background: rgba(255, 255, 255, 0.9);
            padding: 12px;
            border-radius: 8px;
            border: 2px solid var(--primary);
            min-width: 120px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        .stat-label {
            font-size: 0.8rem;
            color: var(--primary);
            margin-bottom: 6px;
            font-weight: 600;
        }
        .stat-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .setup-screen {
            text-align: center;
            padding: 20px 10px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .team-setup {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .team-input {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid var(--primary);
            width: 300px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .team-input h3 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.2rem;
            font-weight: 700;
        }
        input, select {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: 2px solid var(--info);
            border-radius: 6px;
            background: white;
            font-size: 0.9rem;
            font-weight: 500;
        }
        input:focus, select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 8px rgba(255, 171, 0, 0.3);
        }
        .player-input {
            display: flex;
            gap: 10px;
            margin: 12px 0;
            align-items: center;
        }
        .add-player-btn {
            background: var(--info);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        .add-player-btn:hover {
            background: var(--success);
            transform: scale(1.1);
        }
        .player-list {
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            background: rgba(248, 249, 250, 0.8);
            border-radius: 8px;
            padding: 12px;
            border: 2px solid var(--info);
        }
        .player-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 6px 0;
            background: white;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            border: 2px solid var(--info);
            transition: all 0.3s ease;
        }
        .player-list-item:hover {
            background: var(--info);
            color: white;
            transform: translateX(5px);
        }
        .remove-player-btn {
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        .remove-player-btn:hover {
            background: #c62828;
            transform: scale(1.1);
        }
        .answering-player {
            text-align: center;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 8px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            border: 2px solid var(--primary);
        }
        .menu-btn {
            background: linear-gradient(135deg, var(--info), #1565c0);
            color: white;
            margin-top: 15px;
        }
        
        /* Gioco Finale */
        .final-game-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 15px;
            color: white;
        }
        .final-game-content {
            background: rgba(255, 255, 255, 0.15);
            padding: 25px;
            border-radius: 15px;
            border: 3px solid rgba(253, 187, 45, 0.5);
            text-align: center;
            max-width: 900px;
            width: 95%;
            backdrop-filter: blur(15px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
        }
        .final-game-title {
            font-size: 2.5rem;
            color: var(--gold);
            margin-bottom: 20px;
            font-weight: 800;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.8);
        }
        .final-game-subtitle {
            font-size: 1.4rem;
            margin-bottom: 25px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        .final-game-info {
            font-size: 1rem;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.4);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            text-align: left;
        }
        .prize-display {
            font-size: 2rem;
            font-weight: bold;
            margin: 20px 0;
            padding: 20px;
            background: rgba(46, 204, 113, 0.4);
            border-radius: 12px;
            border: 3px solid var(--success);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        .player-turn {
            font-size: 1.2rem;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        .chain-display {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 20px 0;
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        .chain-word {
            padding: 15px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            font-size: 1.3rem;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .chain-word.revealed {
            background: linear-gradient(135deg, rgba(253, 187, 45, 0.6), rgba(253, 187, 45, 0.3));
            border-left: 4px solid var(--accent);
            transform: translateX(4px);
        }
        .chain-word.hidden {
            background: linear-gradient(135deg, rgba(178, 31, 31, 0.4), rgba(178, 31, 31, 0.2));
            border-left: 4px solid var(--secondary);
            color: transparent;
        }
        .chain-word.partial {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.4), rgba(41, 128, 185, 0.2));
            border-left: 4px solid var(--info);
        }
        .chain-word.current {
            box-shadow: 0 0 15px rgba(253, 187, 45, 0.8);
            transform: scale(1.02);
        }
        .letter-reveal {
            font-size: 1.4rem;
            margin: 15px 0;
            padding: 15px;
            background: rgba(52, 152, 219, 0.4);
            border-radius: 10px;
            border: 2px solid var(--info);
            font-family: monospace;
            letter-spacing: 3px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }
        .final-timer {
            font-size: 2rem;
            font-weight: bold;
            margin: 20px 0;
            padding: 20px;
            background: rgba(231, 76, 60, 0.4);
            border-radius: 12px;
            border: 3px solid var(--danger);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        .final-game-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .final-game-btn {
            padding: 15px 25px;
            font-size: 1rem;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        .final-start-btn {
            background: linear-gradient(135deg, var(--success), #27ae60);
            color: white;
        }
        .final-jolly-btn {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
        }
        .final-answer-btn {
            background: linear-gradient(135deg, var(--info), #2980b9);
            color: white;
        }
        .final-next-btn {
            background: linear-gradient(135deg, var(--accent), #f39c12);
            color: var(--dark);
        }
        .final-game-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }
        .final-game-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .jolly-counter {
            font-size: 1.1rem;
            margin: 12px 0;
            padding: 12px;
            background: rgba(155, 89, 182, 0.4);
            border-radius: 8px;
            border: 2px solid #9b59b6;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        /* Total Money Display */
        .total-money-display {
            position: fixed;
            top: 15px;
            right: 15px;
            background: linear-gradient(135deg, var(--gold), var(--warning));
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 700;
            border: 2px solid var(--accent);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.25);
            z-index: 1000;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        /* Character Selection */
        .character-selection {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            margin: 15px 0;
        }
        .character-option {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid var(--info);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            background: white;
        }
        .character-option:hover {
            transform: scale(1.1);
            border-color: var(--accent);
        }
        .character-option.selected {
            border-color: var(--success);
            background: var(--success);
            color: white;
            transform: scale(1.1);
        }

        /* Money Input */
        .money-input-container {
            margin: 8px 0;
        }
        .money-input-container label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            color: var(--primary);
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 8px;
            }
            
            .game-layout {
                flex-direction: column;
                gap: 8px;
            }
            
            .team-sidebar {
                flex: 0 0 auto;
                min-height: 180px;
                width: 100%;
            }
            
            .team-setup {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
            
            .team-input {
                width: 100%;
                max-width: 350px;
                padding: 15px;
            }
            
            .word {
                font-size: 2rem;
                padding: 15px;
            }
            
            .timer {
                font-size: 2rem;
                padding: 12px 20px;
            }
            
            .seconds-label {
                font-size: 1rem;
            }
            
            .stats-container {
                gap: 8px;
            }
            
            .stat-box {
                min-width: 100px;
                padding: 10px;
            }
            
            .stat-label {
                font-size: 0.7rem;
            }
            
            .stat-value {
                font-size: 1.1rem;
            }
            
            .final-game-title {
                font-size: 2rem;
            }
            
            .final-game-subtitle {
                font-size: 1.1rem;
            }
            
            .chain-word {
                font-size: 1.1rem;
                padding: 12px;
                min-height: 50px;
            }
            
            .final-game-btn {
                padding: 12px 20px;
                font-size: 0.9rem;
            }
            
            .final-timer {
                font-size: 1.6rem;
                padding: 15px;
            }
            
            .final-game-content {
                padding: 20px;
            }
            
            .total-money-display {
                position: relative;
                top: auto;
                right: auto;
                margin: 10px auto;
                width: fit-content;
                font-size: 1rem;
                padding: 10px 15px;
            }
            
            button {
                padding: 10px 15px;
                font-size: 0.8rem;
            }
            
            .controls {
                gap: 8px;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.5rem;
            }
            
            .team-name {
                font-size: 1rem;
                padding: 10px;
            }
            
            .score {
                font-size: 1.3rem;
                padding: 10px;
            }
            
            .word {
                font-size: 1.8rem;
            }
            
            .timer {
                font-size: 1.8rem;
                padding: 10px 15px;
            }
            
            .character-option {
                width: 50px;
                height: 50px;
                font-size: 1.3rem;
            }
            
            .final-game-title {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- Total Money Display -->
    <div class="total-money-display">
        <i class="fas fa-coins"></i> TOTALE: â‚¬<span id="totalMoney">0</span>
    </div>

    <!-- Schermata di Setup -->
    <div class="container setup-screen" id="setupScreen">
        <header>
            <h1>ðŸŽ¯ INTESA VINCENTE</h1>
            <p class="subtitle">3 passi per squadra - 2 raddoppi. Inizia sempre Squadra A.</p>
        </header>
      
        <div class="team-setup">
            <div class="team-input">
                <h3><i class="fas fa-users"></i> SQUADRA A</h3>
                <input type="text" id="teamAName" placeholder="Nome Squadra A" value="Squadra A">
                
                <div class="money-input-container">
                    <label>Punti Iniziali:</label>
                    <input type="number" id="teamAInitialPoints" placeholder="Punti iniziali" value="0" min="0">
                </div>
                
                <div class="character-selection" id="teamACharacters">
                    <div class="character-option" data-char="ðŸ‘¨">ðŸ‘¨</div>
                    <div class="character-option" data-char="ðŸ‘©">ðŸ‘©</div>
                    <div class="character-option" data-char="ðŸ§”">ðŸ§”</div>
                    <div class="character-option" data-char="ðŸ‘´">ðŸ‘´</div>
                    <div class="character-option" data-char="ðŸ‘µ">ðŸ‘µ</div>
                    <div class="character-option" data-char="ðŸ¦¸">ðŸ¦¸</div>
                </div>
                
                <div class="player-input">
                    <input type="text" id="teamAPlayerInput" placeholder="Nome giocatore">
                    <button class="add-player-btn" id="addTeamAPlayer"><i class="fas fa-plus"></i></button>
                </div>
                <div class="player-list" id="teamAPlayerList"></div>
            </div>
          
            <div class="team-input">
                <h3><i class="fas fa-users"></i> SQUADRA B</h3>
                <input type="text" id="teamBName" placeholder="Nome Squadra B" value="Squadra B">
                
                <div class="money-input-container">
                    <label>Punti Iniziali:</label>
                    <input type="number" id="teamBInitialPoints" placeholder="Punti iniziali" value="0" min="0">
                </div>
                
                <div class="character-selection" id="teamBCharacters">
                    <div class="character-option" data-char="ðŸ‘¨">ðŸ‘¨</div>
                    <div class="character-option" data-char="ðŸ‘©">ðŸ‘©</div>
                    <div class="character-option" data-char="ðŸ§”">ðŸ§”</div>
                    <div class="character-option" data-char="ðŸ‘´">ðŸ‘´</div>
                    <div class="character-option" data-char="ðŸ‘µ">ðŸ‘µ</div>
                    <div class="character-option" data-char="ðŸ¦¸">ðŸ¦¸</div>
                </div>
                
                <div class="player-input">
                    <input type="text" id="teamBPlayerInput" placeholder="Nome giocatore">
                    <button class="add-player-btn" id="addTeamBPlayer"><i class="fas fa-plus"></i></button>
                </div>
                <div class="player-list" id="teamBPlayerList"></div>
            </div>
        </div>
      
        <button class="start-btn" id="startGameBtn" style="padding: 15px 30px; margin: 0 auto; font-size: 1rem;">
            <i class="fas fa-play-circle"></i> INIZIA IL GIOCO
        </button>
    </div>

    <!-- Schermata di Gioco -->
    <div class="container hidden" id="gameScreen">
        <header>
            <h1>ðŸŽ¯ INTESA VINCENTE</h1>
        </header>
      
        <div class="game-layout">
            <!-- Squadra A -->
            <div class="team-sidebar" id="teamASidebar">
                <div class="team-name" id="displayTeamA"><i class="fas fa-users"></i> Squadra A</div>
                <div class="score" id="scoreA">0 Punti</div>
                <div class="money-display">â‚¬<span id="moneyA">0</span></div>
                <div class="players-list" id="teamAPlayersList"></div>
            </div>
          
            <!-- Area Centrale di Gioco -->
            <div class="game-center">
                <div class="timer-section">
                    <div class="timer" id="timer">
                        <span>60</span>
                        <span class="seconds-label">SECONDI</span>
                    </div>
                    <div class="stats-container" id="statsContainer">
                        <div class="stat-box">
                            <div class="stat-label">PASSI UTILIZZATI</div>
                            <div class="stat-value" id="passiUtilizzati">0</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">PASSI RESTANTI</div>
                            <div class="stat-value" id="passiRestanti">3</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">RADDOPPI UTILIZZATI</div>
                            <div class="stat-value" id="raddoppiUtilizzati">0</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">RADDOPPI RESTANTI</div>
                            <div class="stat-value" id="raddoppiRestanti">2</div>
                        </div>
                    </div>
                </div>
              
                <div class="word-display">
                    <div class="word hidden" id="currentWord">PAROLA</div>
                </div>
              
                <div class="controls">
                    <button class="start-btn" id="startTurnBtn">
                        <i class="fas fa-play"></i> INIZIA
                    </button>
                    <button class="stop-btn" id="stopTimerBtn" disabled>
                        <i class="fas fa-pause"></i> STOP
                    </button>
                    <button class="raddoppio-btn" id="raddoppioBtn" disabled>
                        <i class="fas fa-bolt"></i> RADDOPPIA
                    </button>
                    <button class="next-btn" id="passoBtn" disabled>
                        <i class="fas fa-forward"></i> PASSO
                    </button>
                </div>
              
                <div class="answer-controls hidden" id="answerControls">
                    <div class="answering-player" id="answeringPlayer">
                        <i class="fas fa-user"></i> Risponde: Squadra A
                    </div>
                    <div style="display: flex; gap: 15px;">
                        <button class="correct-btn" id="correctBtn">
                            <i class="fas fa-check"></i> ESATTA (+â‚¬1000)
                        </button>
                        <button class="wrong-btn" id="wrongBtn">
                            <i class="fas fa-times"></i> ERRATA (-â‚¬1000)
                        </button>
                    </div>
                </div>
            </div>
          
            <!-- Squadra B -->
            <div class="team-sidebar" id="teamBSidebar">
                <div class="team-name" id="displayTeamB"><i class="fas fa-users"></i> Squadra B</div>
                <div class="score" id="scoreB">0 Punti</div>
                <div class="money-display">â‚¬<span id="moneyB">0</span></div>
                <div class="players-list" id="teamBPlayersList"></div>
            </div>
        </div>
    </div>

    <!-- Schermata Gioco Finale - L'ULTIMA CATENA -->
    <div class="final-game-screen hidden" id="finalGameScreen">
        <div class="final-game-content">
            <div class="final-game-title">
                <i class="fas fa-trophy"></i> L'ULTIMA CATENA
            </div>
            
            <div class="final-game-subtitle">
                La squadra <span id="winningTeamName">VINCITRICE</span> accede al gioco finale!
            </div>
            
            <div class="final-game-info">
                <p><strong>Regole del gioco:</strong></p>
                <p>â€¢ La catena Ã¨ composta da 13 parole. Sono visibili le parole in posizione dispari (1Âª, 3Âª, 5Âª, ...).</p>
                <p>â€¢ Dovete indovinare le 6 parole nascoste in posizione pari (2Âª, 4Âª, 6Âª, ...).</p>
                <p>â€¢ Ogni errore dimezza il montepremi.</p>
                <p>â€¢ Avete 2 jolly a disposizione che rivelano una lettera senza penalitÃ .</p>
                <p>â€¢ Senza jolly, ogni errore dimezza il premio e rivela una lettera.</p>
            </div>
            
            <div class="prize-display" id="finalPrizeDisplay">
                Montepremi attuale: â‚¬<span id="currentPrize">10,000</span>
            </div>
            
            <div class="jolly-counter">
                <i class="fas fa-star"></i> JOLLY DISPONIBILI: <span id="jollyCount">2</span>
            </div>
            
            <div class="player-turn" id="playerTurnDisplay">
                Turno di: <span id="currentPlayer">Giocatore 1</span>
            </div>
            
            <div class="chain-display" id="chainDisplay">
                <!-- Le parole della catena verranno inserite qui dinamicamente -->
            </div>
            
            <div class="letter-reveal" id="letterRevealDisplay">
                Lettere rivelate: <span id="revealedLetters">X</span>
            </div>
            
            <div class="final-timer" id="finalTimer">
                20
            </div>
            
            <div class="final-game-controls">
                <button class="final-start-btn" id="finalStartBtn">
                    <i class="fas fa-play"></i> INIZIA
                </button>
                <button class="final-jolly-btn" id="finalJollyBtn" disabled>
                    <i class="fas fa-star"></i> USA JOLLY
                </button>
                <button class="final-answer-btn" id="finalAnswerBtn" disabled>
                    <i class="fas fa-bullhorn"></i> RISPOSTA
                </button>
                <button class="final-next-btn" id="finalNextBtn" disabled>
                    <i class="fas fa-forward"></i> PROSSIMA
                </button>
            </div>
        </div>
    </div>

    <script>
        // Il codice JavaScript rimane identico al precedente
        // Variabili globali
        let teamAPlayers = [];
        let teamBPlayers = [];
        let puntiA = 0;
        let puntiB = 0;
        let moneyA = 0;
        let moneyB = 0;
        let totalMoney = 0;
        let currentTeam = 'A';
        let timeLeft = 60;
        let timerInterval;
        let gameActive = false;
        let normalWordIndex = 0;
        let doubleWordIndex = 0;
        let puntiTotalizzati = 0;
        let isRaddoppioAttivo = false;
        let raddoppioPerParola = false;
        let availableWords = [];
        let availableDoubleWords = [];
        
        // Variabili per passi e raddoppi
        let teamA_completedRounds = 0;
        let teamB_completedRounds = 0;
        let teamA_passiUtilizzati = 0;
        let teamB_passiUtilizzati = 0;
        let teamA_raddoppiUtilizzati = 0;
        let teamB_raddoppiUtilizzati = 0;
        let maxPassi = 3;
        let maxRaddoppi = 2;
        let gameCompleted = false;
        
        // Variabili per il gioco finale
        let finalGameActive = false;
        let finalChainWords = [];
        let finalHiddenWords = [];
        let finalCurrentWordIndex = 1;
        let finalPrizePercentage = 100;
        let finalJollyCount = 2;
        let finalCurrentPlayerIndex = 0;
        let finalRevealedLetters = [];
        let finalTimerInterval;
        let finalTimeLeft = 20;
        let winningTeam = '';
        let winningTeamPlayers = [];
        
        // Database di parole
        const words = [
            "LAMPADINA", "TRENO", "PIZZA", "CANE", "OMBRELLO",
            "SOLDATO", "MARE", "COMPUTER", "DOTTORE", "LUNA",
            "MARTELLO", "CHITARRA", "SCUOLA", "BAMBINO", "CAFFÃˆ",
            "AEREO", "SCARPE", "GIARDINO", "LEONE", "TAVOLO",
            "GELATO", "TELEFONO", "OROLOGIO", "NUVOLA", "BIBLIOTECA"
        ];

        const doublePhrases = [
            "CAVALLO MARINO", "CARTA IGIENICA", "TELEFONO FISSO", "ACQUA CALDA",
            "LETTO MATRIMONIALE", "OCCHIALI DA SOLE", "PORTA FINESTRA", "SPAZZOLINO DENTI"
        ];
        
        // Catene per il gioco finale
        const finalChains = [
            {
                words: ["SAMBA", "CARNEVALE", "COPACABANA", "CAIPIRINHA", "AMAZZONIA", "PALME", "CALCIO", "PELÃ‰", "CARIOCA", "FESTA", "COLORE", "CALORE", "PASSIONE"],
                hiddenWords: [1, 3, 5, 7, 9, 11]
            }
        ];
        
        // Elementi DOM
        const setupScreen = document.getElementById('setupScreen');
        const gameScreen = document.getElementById('gameScreen');
        const finalGameScreen = document.getElementById('finalGameScreen');
        const timerDisplay = document.getElementById('timer');
        const currentWordDisplay = document.getElementById('currentWord');
        const totalMoneyDisplay = document.getElementById('totalMoney');
        
        // Elementi DOM per il gioco finale
        const winningTeamName = document.getElementById('winningTeamName');
        const finalPrizeDisplay = document.getElementById('currentPrize');
        const playerTurnDisplay = document.getElementById('currentPlayer');
        const chainDisplay = document.getElementById('chainDisplay');
        const letterRevealDisplay = document.getElementById('revealedLetters');
        const finalTimer = document.getElementById('finalTimer');
        const finalStartBtn = document.getElementById('finalStartBtn');
        const finalJollyBtn = document.getElementById('finalJollyBtn');
        const finalAnswerBtn = document.getElementById('finalAnswerBtn');
        const finalNextBtn = document.getElementById('finalNextBtn');
        const jollyCount = document.getElementById('jollyCount');
        
        // Setup giocatori
        document.getElementById('addTeamAPlayer').addEventListener('click', () => addPlayer('A'));
        document.getElementById('addTeamBPlayer').addEventListener('click', () => addPlayer('B'));
        document.getElementById('startGameBtn').addEventListener('click', startGame);
        
        // Event listeners per il gioco finale
        finalStartBtn.addEventListener('click', startFinalGame);
        finalJollyBtn.addEventListener('click', useJolly);
        finalAnswerBtn.addEventListener('click', showAnswerInput);
        finalNextBtn.addEventListener('click', nextFinalWord);
        
        // Character selection
        document.querySelectorAll('.character-option').forEach(option => {
            option.addEventListener('click', function() {
                const team = this.closest('.team-input').querySelector('h3').textContent.includes('A') ? 'A' : 'B';
                selectCharacter(team, this.dataset.char);
            });
        });
        
        function selectCharacter(team, character) {
            const options = document.querySelectorAll(`#team${team}Characters .character-option`);
            options.forEach(opt => opt.classList.remove('selected'));
            event.target.classList.add('selected');
        }
        
        function addPlayer(team) {
            const input = document.getElementById(`team${team}PlayerInput`);
            const list = document.getElementById(`team${team}PlayerList`);
            const playerName = input.value.trim();
            const selectedChar = document.querySelector(`#team${team}Characters .character-option.selected`);
            const character = selectedChar ? selectedChar.dataset.char : 'ðŸ‘¤';
          
            if (playerName) {
                const players = team === 'A' ? teamAPlayers : teamBPlayers;
                players.push({name: playerName, character: character});
                updatePlayerList(team);
                input.value = '';
            }
        }
        
        function removePlayer(team, index) {
            const players = team === 'A' ? teamAPlayers : teamBPlayers;
            players.splice(index, 1);
            updatePlayerList(team);
        }
        
        function updatePlayerList(team) {
            const list = document.getElementById(`team${team}PlayerList`);
            const players = team === 'A' ? teamAPlayers : teamBPlayers;
          
            list.innerHTML = '';
            players.forEach((player, index) => {
                const playerItem = document.createElement('div');
                playerItem.className = 'player-list-item';
                playerItem.innerHTML = `
                    <span>${player.character} ${player.name}</span>
                    <button class="remove-player-btn" onclick="removePlayer('${team}', ${index})"><i class="fas fa-times"></i></button>
                `;
                list.appendChild(playerItem);
            });
        }
        
        function startGame() {
            // Aggiorna nomi squadre
            document.getElementById('displayTeamA').textContent = document.getElementById('teamAName').value;
            document.getElementById('displayTeamB').textContent = document.getElementById('teamBName').value;
          
            // Carica i punti iniziali
            const initialPointsA = parseInt(document.getElementById('teamAInitialPoints').value) || 0;
            const initialPointsB = parseInt(document.getElementById('teamBInitialPoints').value) || 0;
            
            puntiA = initialPointsA;
            puntiB = initialPointsB;
            moneyA = initialPointsA * 1000;
            moneyB = initialPointsB * 1000;
          
            // Aggiorna liste giocatori
            updatePlayersInSidebars();
          
            // Passa alla schermata di gioco
            setupScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
          
            // Inizializza il gioco
            initGame();
        }
        
        function updatePlayersInSidebars() {
            updatePlayersInSidebar('teamAPlayersList', teamAPlayers);
            updatePlayersInSidebar('teamBPlayersList', teamBPlayers);
        }
        
        function updatePlayersInSidebar(elementId, players) {
            const element = document.getElementById(elementId);
            element.innerHTML = '';
            players.forEach(player => {
                const playerItem = document.createElement('div');
                playerItem.className = 'player-item';
                playerItem.innerHTML = `${player.character} ${player.name}`;
                element.appendChild(playerItem);
            });
        }
        
        function initGame() {
            // Mescola le parole
            shuffleWords();
          
            updatePunti();
            updateMoney();
            updateActiveTeam();
            updateStats();
            currentWordDisplay.classList.add('hidden');
            puntiTotalizzati = 0;
            isRaddoppioAttivo = false;
            raddoppioPerParola = false;
            gameCompleted = false;
            teamA_completedRounds = 0;
            teamB_completedRounds = 0;
            teamA_passiUtilizzati = 0;
            teamB_passiUtilizzati = 0;
            teamA_raddoppiUtilizzati = 0;
            teamB_raddoppiUtilizzati = 0;
            normalWordIndex = 0;
            doubleWordIndex = 0;
        }
        
        function shuffleWords() {
            // Mescola le parole singole
            availableWords = [...words];
            for (let i = availableWords.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [availableWords[i], availableWords[j]] = [availableWords[j], availableWords[i]];
            }
          
            // Mescola le parole doppie
            availableDoubleWords = [...doublePhrases];
            for (let i = availableDoubleWords.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [availableDoubleWords[i], availableDoubleWords[j]] = [availableDoubleWords[j], availableDoubleWords[i]];
            }
        }
        
        function updateActiveTeam() {
            document.getElementById('teamASidebar').classList.remove('active');
            document.getElementById('teamBSidebar').classList.remove('active');
          
            if (currentTeam === 'A') {
                document.getElementById('teamASidebar').classList.add('active');
            } else {
                document.getElementById('teamBSidebar').classList.add('active');
            }
          
            document.getElementById('answeringPlayer').innerHTML = `<i class="fas fa-user"></i> Risponde: ${currentTeam === 'A' ? document.getElementById('displayTeamA').textContent : document.getElementById('displayTeamB').textContent}`;
        }
        
        function updatePunti() {
            document.getElementById('scoreA').textContent = `${puntiA} Punti`;
            document.getElementById('scoreB').textContent = `${puntiB} Punti`;
        }
        
        function updateMoney() {
            document.getElementById('moneyA').textContent = moneyA.toLocaleString();
            document.getElementById('moneyB').textContent = moneyB.toLocaleString();
            totalMoneyDisplay.textContent = totalMoney.toLocaleString();
        }
        
        function updateStats() {
            const passiUtilizzati = currentTeam === 'A' ? teamA_passiUtilizzati : teamB_passiUtilizzati;
            const raddoppiUtilizzati = currentTeam === 'A' ? teamA_raddoppiUtilizzati : teamB_raddoppiUtilizzati;
            document.getElementById('passiUtilizzati').textContent = passiUtilizzati;
            document.getElementById('passiRestanti').textContent = Math.max(0, maxPassi - passiUtilizzati);
            document.getElementById('raddoppiUtilizzati').textContent = raddoppiUtilizzati;
            document.getElementById('raddoppiRestanti').textContent = Math.max(0, maxRaddoppi - raddoppiUtilizzati);
        }
        
        function showNextWord() {
            if (isRaddoppioAttivo && raddoppioPerParola) {
                if (doubleWordIndex < availableDoubleWords.length) {
                    currentWordDisplay.textContent = availableDoubleWords[doubleWordIndex++];
                } else {
                    currentWordDisplay.textContent = "FINE PAROLE DOPPIE";
                    endTurn();
                    return;
                }
            } else {
                if (normalWordIndex < availableWords.length) {
                    currentWordDisplay.textContent = availableWords[normalWordIndex++];
                } else {
                    currentWordDisplay.textContent = "FINE PAROLE";
                    endTurn();
                    return;
                }
            }
          
            currentWordDisplay.classList.remove('hidden');
        }
        
        // Controlli di gioco
        document.getElementById('startTurnBtn').addEventListener('click', startTurn);
        document.getElementById('stopTimerBtn').addEventListener('click', stopTimer);
        document.getElementById('raddoppioBtn').addEventListener('click', attivaRaddoppio);
        document.getElementById('passoBtn').addEventListener('click', usaPasso);
        document.getElementById('correctBtn').addEventListener('click', handleCorrectAnswer);
        document.getElementById('wrongBtn').addEventListener('click', handleWrongAnswer);
        
        function startTurn() {
            if (gameActive) return;
          
            gameActive = true;
            timeLeft = 60;
            timerDisplay.querySelector('span').textContent = timeLeft;
            puntiTotalizzati = 0;
            isRaddoppioAttivo = false;
            raddoppioPerParola = false;
          
            document.getElementById('startTurnBtn').disabled = true;
            document.getElementById('stopTimerBtn').disabled = false;
            document.getElementById('raddoppioBtn').disabled = false;
            document.getElementById('passoBtn').disabled = false;
            document.getElementById('answerControls').classList.add('hidden');
          
            showNextWord();
            startTimer();
        }
        
        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                timerDisplay.querySelector('span').textContent = timeLeft;
              
                if (timeLeft <= 0) {
                    endTurn();
                }
            }, 1000);
        }
        
        function stopTimer() {
            if (!gameActive) return;
          
            clearInterval(timerInterval);
            document.getElementById('answerControls').classList.remove('hidden');
            document.getElementById('stopTimerBtn').disabled = true;
            document.getElementById('raddoppioBtn').disabled = true;
            document.getElementById('passoBtn').disabled = true;
        }
        
        function attivaRaddoppio() {
            const raddoppiUtilizzati = currentTeam === 'A' ? teamA_raddoppiUtilizzati : teamB_raddoppiUtilizzati;
            if (!gameActive || isRaddoppioAttivo || raddoppiUtilizzati >= maxRaddoppi) return;
          
            isRaddoppioAttivo = true;
            raddoppioPerParola = true;
            if (currentTeam === 'A') {
                teamA_raddoppiUtilizzati++;
            } else {
                teamB_raddoppiUtilizzati++;
            }
            document.getElementById('raddoppioBtn').disabled = true;
            document.getElementById('raddoppioBtn').innerHTML = '<i class="fas fa-bolt"></i> RADDOPPIO ATTIVO';
            updateStats();
          
            // Mostra subito una parola doppia
            showNextWord();
        }
        
        function usaPasso() {
            const passiUtilizzati = currentTeam === 'A' ? teamA_passiUtilizzati : teamB_passiUtilizzati;
            if (!gameActive || passiUtilizzati >= maxPassi) return;
          
            if (currentTeam === 'A') {
                teamA_passiUtilizzati++;
            } else {
                teamB_passiUtilizzati++;
            }
            updateStats();
          
            // Se abbiamo usato tutti i passi, disabilita il pulsante
            if ((currentTeam === 'A' ? teamA_passiUtilizzati : teamB_passiUtilizzati) >= maxPassi) {
                document.getElementById('passoBtn').disabled = true;
            }
          
            // Passa alla parola successiva
            showNextWord();
        }
        
        function handleCorrectAnswer() {
            const punti = isRaddoppioAttivo && raddoppioPerParola ? 2 : 1;
            const valorePunto = 1000; // â‚¬1000 per punto
            
            puntiTotalizzati += punti;
          
            if (currentTeam === 'A') {
                puntiA += punti;
                moneyA += punti * valorePunto;
            } else {
                puntiB += punti;
                moneyB += punti * valorePunto;
            }
          
            // Disattiva il raddoppio dopo una risposta corretta
            if (isRaddoppioAttivo && raddoppioPerParola) {
                isRaddoppioAttivo = false;
                raddoppioPerParola = false;
                document.getElementById('raddoppioBtn').innerHTML = '<i class="fas fa-bolt"></i> RADDOPPIA';
            }
          
            updatePunti();
            updateMoney();
            document.getElementById('answerControls').classList.add('hidden');
            document.getElementById('stopTimerBtn').disabled = false;
            document.getElementById('raddoppioBtn').disabled = false;
            document.getElementById('passoBtn').disabled = false;
          
            showNextWord();
            startTimer();
        }
        
        function handleWrongAnswer() {
            const valorePunto = 1000; // â‚¬1000 per punto
          
            // Togli 1 punto quando si sbaglia (solo se hanno punti)
            if (currentTeam === 'A' && puntiA > 0) {
                puntiA -= 1;
                moneyA = Math.max(0, moneyA - valorePunto);
            } else if (currentTeam === 'B' && puntiB > 0) {
                puntiB -= 1;
                moneyB = Math.max(0, moneyB - valorePunto);
            }
          
            // Disattiva il raddoppio dopo una risposta errata
            if (isRaddoppioAttivo && raddoppioPerParola) {
                isRaddoppioAttivo = false;
                raddoppioPerParola = false;
                document.getElementById('raddoppioBtn').innerHTML = '<i class="fas fa-bolt"></i> RADDOPPIA';
            }
          
            updatePunti();
            updateMoney();
            document.getElementById('answerControls').classList.add('hidden');
            document.getElementById('stopTimerBtn').disabled = false;
            document.getElementById('raddoppioBtn').disabled = false;
            document.getElementById('passoBtn').disabled = false;
          
            showNextWord();
            startTimer();
        }
        
        function endTurn() {
            clearInterval(timerInterval);
            gameActive = false;

            document.getElementById('startTurnBtn').disabled = false;
            document.getElementById('stopTimerBtn').disabled = true;
            document.getElementById('raddoppioBtn').disabled = true;
            document.getElementById('passoBtn').disabled = true;
            document.getElementById('answerControls').classList.add('hidden');
            currentWordDisplay.classList.add('hidden');

            // Segna che la squadra corrente ha completato il suo turno
            if (currentTeam === 'A') {
                teamA_completedRounds = 1;
                console.log("Squadra A ha completato il turno");
            } else {
                teamB_completedRounds = 1;
                console.log("Squadra B ha completato il turno");
            }

            // CONTROLLO PRINCIPALE: se entrambe le squadre hanno completato il loro turno
            if (teamA_completedRounds === 1 && teamB_completedRounds === 1) {
                console.log("ENTRAMBE LE SQUADRE HANNO COMPLETATO I LORO TURNI - DETERMINAZIONE VINCITORE");
                determineWinningTeam();
                startFinalGameScreen();
                return; // Esci dalla funzione qui
            }

            // Se non Ã¨ il caso di andare al gioco finale, passa alla squadra successiva
            currentTeam = currentTeam === 'A' ? 'B' : 'A';
            updateActiveTeam();
            updateStats();
            
            // Reset dei contatori per il turno successivo
            teamA_passiUtilizzati = 0;
            teamB_passiUtilizzati = 0;
            teamA_raddoppiUtilizzati = 0;
            teamB_raddoppiUtilizzati = 0;
            
            document.getElementById('startTurnBtn').innerHTML = `<i class="fas fa-play"></i> TOCCA A ${currentTeam === 'A' ? document.getElementById('displayTeamA').textContent.toUpperCase() : document.getElementById('displayTeamB').textContent.toUpperCase()} - INIZIA`;
            document.getElementById('raddoppioBtn').innerHTML = '<i class="fas fa-bolt"></i> RADDOPPIA';
            document.getElementById('raddoppioBtn').disabled = true;
            document.getElementById('passoBtn').disabled = true;
        }
        
        function determineWinningTeam() {
            // Determina la squadra con piÃ¹ punti
            if (puntiA > puntiB) {
                winningTeam = 'A';
                winningTeamPlayers = teamAPlayers;
                console.log(`Squadra A vince con ${puntiA} punti contro ${puntiB} punti della Squadra B`);
            } else if (puntiB > puntiA) {
                winningTeam = 'B';
                winningTeamPlayers = teamBPlayers;
                console.log(`Squadra B vince con ${puntiB} punti contro ${puntiA} punti della Squadra A`);
            } else {
                // In caso di pareggio, scegli a caso
                winningTeam = Math.random() < 0.5 ? 'A' : 'B';
                winningTeamPlayers = winningTeam === 'A' ? teamAPlayers : teamBPlayers;
                console.log(`Pareggio! Vince la Squadra ${winningTeam} per sorteggio`);
            }
        }
        
        function startFinalGameScreen() {
            gameScreen.classList.add('hidden');
            finalGameScreen.classList.remove('hidden');
            
            // Inizializza il gioco finale
            initFinalGame();
        }
        
        // GIOCO FINALE - L'ULTIMA CATENA
        function initFinalGame() {
            finalGameActive = false;
            
            // Seleziona una catena casuale
            const randomChainIndex = Math.floor(Math.random() * finalChains.length);
            const selectedChain = finalChains[randomChainIndex];
            finalChainWords = selectedChain.words;
            finalHiddenWords = selectedChain.hiddenWords;
            
            // Inizializza le variabili di gioco
            finalCurrentWordIndex = 1;
            finalPrizePercentage = 100;
            finalJollyCount = 2;
            finalCurrentPlayerIndex = 0;
            finalRevealedLetters = [];
            
            // Inizializza le lettere rivelate per ogni parola nascosta
            for (let i = 0; i < finalHiddenWords.length; i++) {
                finalRevealedLetters[i] = [0]; // Solo la prima lettera inizialmente
            }
            
            // Aggiorna l'interfaccia
            updateFinalGameUI();
            
            // Mostra il nome della squadra vincente
            const winningTeamNameText = winningTeam === 'A' ? 
                document.getElementById('teamAName').value : 
                document.getElementById('teamBName').value;
            winningTeamName.textContent = winningTeamNameText;
        }
        
        function updateFinalGameUI() {
            // Aggiorna il display del premio (â‚¬10,000 come premio base)
            const basePrize = 10000;
            const currentPrize = Math.floor((finalPrizePercentage / 100) * basePrize);
            finalPrizeDisplay.textContent = currentPrize.toLocaleString();
            
            // Aggiorna il conteggio dei jolly
            jollyCount.textContent = finalJollyCount;
            finalJollyBtn.disabled = !finalGameActive || finalJollyCount === 0;
            
            // Aggiorna il turno del giocatore
            const currentPlayer = winningTeamPlayers[finalCurrentPlayerIndex];
            playerTurnDisplay.textContent = `${currentPlayer.character} ${currentPlayer.name}`;
            
            // Aggiorna la visualizzazione della catena
            updateChainDisplay();
            
            // Aggiorna le lettere rivelate per la parola corrente
            updateLetterRevealDisplay();
            
            // Aggiorna lo stato dei pulsanti
            finalStartBtn.disabled = finalGameActive;
            finalAnswerBtn.disabled = !finalGameActive;
            finalNextBtn.disabled = !finalGameActive;
        }
        
        function updateChainDisplay() {
            chainDisplay.innerHTML = '';
            
            for (let i = 0; i < finalChainWords.length; i++) {
                const wordElement = document.createElement('div');
                wordElement.className = 'chain-word';
                
                // Controlla se questa Ã¨ una parola nascosta
                if (finalHiddenWords.includes(i)) {
                    // Ãˆ una parola nascosta
                    const hiddenWordIndex = finalHiddenWords.indexOf(i);
                    
                    if (hiddenWordIndex === finalCurrentWordIndex - 1) {
                        // Parola corrente - mostra le lettere rivelate
                        const revealed = finalRevealedLetters[hiddenWordIndex];
                        const word = finalChainWords[i];
                        let displayText = '';
                        
                        for (let j = 0; j < word.length; j++) {
                            if (revealed.includes(j)) {
                                displayText += word[j];
                            } else {
                                displayText += '_';
                            }
                        }
                        
                        wordElement.textContent = displayText;
                        wordElement.classList.add('partial', 'current');
                    } else if (hiddenWordIndex < finalCurrentWordIndex - 1) {
                        // Parola giÃ  indovinata
                        wordElement.textContent = finalChainWords[i];
                        wordElement.classList.add('revealed');
                    } else {
                        // Parola non ancora raggiunta
                        wordElement.textContent = '?';
                        wordElement.classList.add('hidden');
                    }
                } else {
                    // Parola sempre visibile
                    wordElement.textContent = finalChainWords[i];
                    wordElement.classList.add('revealed');
                }
                
                chainDisplay.appendChild(wordElement);
            }
        }
        
        function updateLetterRevealDisplay() {
            if (finalCurrentWordIndex <= finalHiddenWords.length) {
                const hiddenWordIndex = finalCurrentWordIndex - 1;
                const revealed = finalRevealedLetters[hiddenWordIndex];
                const word = finalChainWords[finalHiddenWords[hiddenWordIndex]];
                let displayText = '';
                
                for (let j = 0; j < word.length; j++) {
                    if (revealed.includes(j)) {
                        displayText += word[j];
                    } else {
                        displayText += '_';
                    }
                }
                
                letterRevealDisplay.textContent = displayText;
            } else {
                letterRevealDisplay.textContent = 'Completato!';
            }
        }
        
        function startFinalGame() {
            if (finalGameActive) return;
            
            finalGameActive = true;
            finalTimeLeft = 20;
            finalTimer.textContent = finalTimeLeft;
            
            // Aggiorna l'interfaccia
            updateFinalGameUI();
            
            // Avvia il timer
            startFinalTimer();
        }
        
        function startFinalTimer() {
            clearInterval(finalTimerInterval);
            finalTimerInterval = setInterval(() => {
                finalTimeLeft--;
                finalTimer.textContent = finalTimeLeft;
                
                if (finalTimeLeft <= 0) {
                    clearInterval(finalTimerInterval);
                    handleFinalTimeExpired();
                }
            }, 1000);
        }
        
        function handleFinalTimeExpired() {
            // Tempo scaduto - aggiungi una lettera e passa al giocatore successivo
            revealAdditionalLetter();
            nextPlayer();
            
            // Riprendi il gioco
            finalTimeLeft = 20;
            finalTimer.textContent = finalTimeLeft;
            startFinalTimer();
        }
        
        function useJolly() {
            if (!finalGameActive || finalJollyCount === 0) return;
            
            finalJollyCount--;
            revealAdditionalLetter();
            
            // Aggiorna l'interfaccia
            updateFinalGameUI();
            
            alert('Jolly utilizzato! Una lettera aggiuntiva Ã¨ stata rivelata.');
        }
        
        function revealAdditionalLetter() {
            if (finalCurrentWordIndex > finalHiddenWords.length) return;
            
            const hiddenWordIndex = finalCurrentWordIndex - 1;
            const word = finalChainWords[finalHiddenWords[hiddenWordIndex]];
            const revealed = finalRevealedLetters[hiddenWordIndex];
            
            // Trova la prossima lettera non rivelata
            for (let i = 0; i < word.length; i++) {
                if (!revealed.includes(i)) {
                    revealed.push(i);
                    break;
                }
            }
            
            // Aggiorna l'interfaccia
            updateChainDisplay();
            updateLetterRevealDisplay();
        }
        
        function showAnswerInput() {
            if (!finalGameActive) return;
            
            // Ferma il timer
            clearInterval(finalTimerInterval);
            
            // Mostra un prompt per inserire la risposta
            const answer = prompt("Inserisci la parola nascosta:");
            
            if (answer) {
                checkFinalAnswer(answer.toUpperCase());
            } else {
                // Riprendi il timer se non Ã¨ stata data risposta
                startFinalTimer();
            }
        }
        
        function checkFinalAnswer(answer) {
            const hiddenWordIndex = finalCurrentWordIndex - 1;
            const correctWord = finalChainWords[finalHiddenWords[hiddenWordIndex]];
            
            if (answer === correctWord) {
                // Risposta corretta
                alert(`Esatto! La parola Ã¨ "${correctWord}"`);
                
                // Passa alla parola successiva
                finalCurrentWordIndex++;
                
                // Controlla se il gioco Ã¨ finito
                if (finalCurrentWordIndex > finalHiddenWords.length) {
                    endFinalGame(true);
                } else {
                    // Passa al giocatore successivo
                    nextPlayer();
                    
                    // Riprendi il gioco
                    finalTimeLeft = 20;
                    finalTimer.textContent = finalTimeLeft;
                    startFinalTimer();
                    
                    // Aggiorna l'interfaccia
                    updateFinalGameUI();
                }
            } else {
                // Risposta errata
                if (finalJollyCount > 0) {
                    // Se ci sono jolly disponibili, chiedi se vuoi usarne uno
                    const useJolly = confirm(`Risposta errata! Vuoi usare un jolly per rivelare una lettera senza penalitÃ ?\n\nJolly disponibili: ${finalJollyCount}`);
                    
                    if (useJolly) {
                        useJolly();
                        startFinalTimer(); // Riprendi il timer
                    } else {
                        // Dimezza il premio e aggiungi una lettera
                        handleWrongFinalAnswer();
                    }
                } else {
                    // Nessun jolly disponibile, dimezza il premio
                    handleWrongFinalAnswer();
                }
            }
        }
        
        function handleWrongFinalAnswer() {
            // Dimezza il premio
            finalPrizePercentage = Math.floor(finalPrizePercentage / 2);
            
            // Aggiungi una lettera
            revealAdditionalLetter();
            
            alert(`Risposta errata! Il montepremi si dimezza. La parola corretta era "${finalChainWords[finalHiddenWords[finalCurrentWordIndex - 1]]}"`);
            
            // Passa al giocatore successivo
            nextPlayer();
            
            // Riprendi il gioco
            finalTimeLeft = 20;
            finalTimer.textContent = finalTimeLeft;
            startFinalTimer();
            
            // Aggiorna l'interfaccia
            updateFinalGameUI();
        }
        
        function nextPlayer() {
            finalCurrentPlayerIndex = (finalCurrentPlayerIndex + 1) % winningTeamPlayers.length;
        }
        
        function nextFinalWord() {
            if (!finalGameActive) return;
            
            // Passa alla parola successiva
            finalCurrentWordIndex++;
            
            // Controlla se il gioco Ã¨ finito
            if (finalCurrentWordIndex > finalHiddenWords.length) {
                endFinalGame(false);
            } else {
                // Passa al giocatore successivo
                nextPlayer();
                
                // Aggiorna l'interfaccia
                updateFinalGameUI();
            }
        }
        
        function endFinalGame(isSuccess) {
            finalGameActive = false;
            clearInterval(finalTimerInterval);
            
            // Calcola il premio finale
            const basePrize = 10000;
            const finalPrize = Math.floor((finalPrizePercentage / 100) * basePrize);
            
            // Aggiungi il premio al totale della squadra vincente
            if (winningTeam === 'A') {
                moneyA += finalPrize;
                totalMoney = moneyA;
            } else {
                moneyB += finalPrize;
                totalMoney = moneyB;
            }
            
            updateMoney();
            
            if (isSuccess) {
                alert(`Complimenti! Avete completato la catena e vinto â‚¬${finalPrize.toLocaleString()}!`);
            } else {
                alert(`Gioco completato! Avete vinto â‚¬${finalPrize.toLocaleString()}.`);
            }
            
            // Torna al menu principale dopo 3 secondi
            setTimeout(() => {
                finalGameScreen.classList.add('hidden');
                setupScreen.classList.remove('hidden');
                resetGame();
            }, 3000);
        }
        
        function resetGame() {
            // Reset di tutte le variabili del gioco (ma mantieni i soldi totali)
            puntiA = 0;
            puntiB = 0;
            moneyA = 0;
            moneyB = 0;
            currentTeam = 'A';
            teamA_completedRounds = 0;
            teamB_completedRounds = 0;
            teamA_passiUtilizzati = 0;
            teamB_passiUtilizzati = 0;
            teamA_raddoppiUtilizzati = 0;
            teamB_raddoppiUtilizzati = 0;
            gameCompleted = false;
            
            // Aggiorna l'interfaccia
            updatePunti();
            updateMoney();
            updateActiveTeam();
            updateStats();
        }
        
        // Inizializzazione
        window.addEventListener('load', () => {
            updatePlayerList('A');
            updatePlayerList('B');
            // Seleziona il primo carattere di default per ogni squadra
            document.querySelector('#teamACharacters .character-option').classList.add('selected');
            document.querySelector('#teamBCharacters .character-option').classList.add('selected');
        });
    </script>
</body>
</html>
