<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intesa Vincente</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        :root {
            --primary: #1a2a6c;
            --secondary: #b21f1f;
            --accent: #fdbb2d;
            --success: #2ecc71;
            --danger: #e74c3c;
            --info: #3498db;
            --dark: #0d1426;
            --light: #f8f9fa;
        }
        body {
            background: #f0f0f0;
            min-height: 100vh;
            color: #333;
            overflow: auto;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        header {
            text-align: center;
            margin-bottom: 15px;
            padding: 15px;
            background: #fff;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        h1 {
            font-size: 2.2rem;
            color: var(--primary);
            margin-bottom: 5px;
            font-weight: 700;
        }
        .subtitle {
            font-size: 1rem;
            color: #666;
        }
        .game-layout {
            display: flex;
            gap: 15px;
            flex: 1;
            min-height: 500px;
        }
        .team-sidebar {
            flex: 0 0 220px;
            background: #fff;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #ddd;
            display: flex;
            flex-direction: column;
        }
        .team-sidebar.active {
            border-color: var(--success);
            background: #f8fff8;
        }
        .team-name {
            font-size: 1.3rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 15px;
            color: var(--primary);
            padding: 12px;
            background: #f0f0f0;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        .team-sidebar.active .team-name {
            color: var(--success);
            border-color: var(--success);
        }
        .score {
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            margin: 15px 0;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        .team-sidebar.active .score {
            border-color: var(--success);
            color: var(--success);
        }
        .money {
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
            margin: 10px 0;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        .team-sidebar.active .money {
            border-color: var(--success);
            color: var(--success);
        }
        .players-list {
            flex: 1;
            overflow-y: auto;
            background: #f0f0f0;
            border-radius: 8px;
            padding: 10px;
            border: 1px solid #ddd;
        }
        .player-item {
            padding: 10px;
            margin: 6px 0;
            background: #fff;
            border-radius: 8px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 500;
            border: 1px solid #ddd;
        }
        .player-item:hover {
            background: #f8f8f8;
        }
        .game-center {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #ddd;
        }
        .timer-section {
            text-align: center;
            margin-bottom: 15px;
        }
        .timer {
            font-size: 3rem;
            font-weight: 700;
            color: var(--danger);
            background: #f0f0f0;
            padding: 15px 30px;
            border-radius: 8px;
            border: 1px solid #ddd;
            margin: 10px 0;
            display: inline-flex;
            align-items: center;
            gap: 15px;
        }
        .seconds-label {
            font-size: 1.5rem;
            font-weight: 600;
            color: #666;
        }
        .word-display {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f0f0f0;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #ddd;
            min-height: 180px;
        }
        .word {
            font-size: 3.5rem;
            font-weight: 700;
            color: var(--primary);
            text-align: center;
            padding: 20px;
        }
        .word.hidden {
            color: transparent;
        }
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        button {
            padding: 12px 20px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        button:hover:not(:disabled) {
            opacity: 0.9;
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .start-btn {
            background: var(--success);
            color: white;
        }
        .stop-btn {
            background: var(--danger);
            color: white;
        }
        .next-btn {
            background: var(--info);
            color: white;
        }
        .raddoppio-btn {
            background: #9b59b6;
            color: white;
        }
        .correct-btn {
            background: var(--success);
            color: white;
            padding: 10px 20px;
        }
        .wrong-btn {
            background: var(--danger);
            color: white;
            padding: 10px 20px;
        }
        .answer-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
            align-items: center;
        }
        .hidden {
            display: none !important;
        }
        .round-info {
            text-align: center;
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: var(--primary);
            background: #f0f0f0;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-weight: 600;
        }
        .stats-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        .stat-box {
            text-align: center;
            background: #f0f0f0;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ddd;
            min-width: 130px;
        }
        .stat-label {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 6px;
        }
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }
        .results-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }
        .results-content {
            background: #fff;
            padding: 40px;
            border-radius: 8px;
            border: 1px solid #ddd;
            text-align: center;
            max-width: 600px;
            width: 90%;
        }
        .results-title {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 30px;
            font-weight: 700;
        }
        .results-points {
            font-size: 4rem;
            font-weight: 700;
            color: var(--success);
            margin: 20px 0;
        }
        .money-input {
            margin: 30px 0;
        }
        .money-input input {
            padding: 15px;
            font-size: 1.5rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            text-align: center;
            width: 250px;
            background: #fff;
            font-weight: 600;
        }
        .money-input input:focus {
            outline: none;
            border-color: var(--accent);
        }
        .total-money {
            font-size: 2rem;
            color: var(--primary);
            margin: 25px 0;
            font-weight: 700;
        }
        .money-calculation {
            font-size: 1.2rem;
            color: #666;
            margin: 15px 0;
            background: #f0f0f0;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        .setup-screen {
            text-align: center;
            padding: 30px 15px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .team-setup {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .team-input {
            background: #fff;
            padding: 25px;
            border-radius: 8px;
            border: 1px solid #ddd;
            width: 320px;
        }
        .team-input h3 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.3rem;
            font-weight: 700;
        }
        input {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #fff;
            font-size: 0.9rem;
            font-weight: 500;
        }
        input:focus {
            outline: none;
            border-color: var(--accent);
        }
        .player-input {
            display: flex;
            gap: 10px;
            margin: 12px 0;
            align-items: center;
        }
        .add-player-btn {
            background: var(--info);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .add-player-btn:hover {
            opacity: 0.9;
        }
        .player-list {
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            background: #f0f0f0;
            border-radius: 8px;
            padding: 12px;
            border: 1px solid #ddd;
        }
        .player-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 6px 0;
            background: #fff;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            border: 1px solid #ddd;
        }
        .player-list-item:hover {
            background: #f8f8f8;
        }
        .remove-player-btn {
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .remove-player-btn:hover {
            opacity: 0.9;
        }
        .answering-player {
            text-align: center;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 8px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        .menu-btn {
            background: var(--info);
            color: white;
            margin-top: 15px;
        }
        
        /* Stili per il gioco finale */
        .final-game-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
            color: white;
        }
        .final-game-content {
            background: rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 16px;
            border: 2px solid rgba(253, 187, 45, 0.3);
            text-align: center;
            max-width: 800px;
            width: 90%;
            backdrop-filter: blur(10px);
        }
        .final-game-title {
            font-size: 3rem;
            color: var(--accent);
            margin-bottom: 30px;
            font-weight: 800;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.7);
        }
        .final-game-subtitle {
            font-size: 1.5rem;
            margin-bottom: 40px;
            color: white;
        }
        .final-game-info {
            font-size: 1.2rem;
            margin-bottom: 30px;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .chain-display {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 30px 0;
            background: rgba(0, 0, 0, 0.4);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .chain-word {
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        .chain-word.revealed {
            background: linear-gradient(135deg, rgba(253, 187, 45, 0.4), rgba(253, 187, 45, 0.2));
            border-left: 4px solid var(--accent);
            transform: translateX(4px);
        }
        .chain-word.hidden {
            background: linear-gradient(135deg, rgba(178, 31, 31, 0.3), rgba(178, 31, 31, 0.2));
            border-left: 4px solid var(--secondary);
            color: transparent;
        }
        .chain-word.partial {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.3), rgba(41, 128, 185, 0.2));
            border-left: 4px solid var(--info);
        }
        .final-game-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        .final-game-btn {
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .final-start-btn {
            background: linear-gradient(135deg, var(--success), #27ae60);
            color: white;
        }
        .final-jolly-btn {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
        }
        .final-answer-btn {
            background: linear-gradient(135deg, var(--info), #2980b9);
            color: white;
        }
        .final-next-btn {
            background: linear-gradient(135deg, var(--accent), #f39c12);
            color: var(--dark);
        }
        .final-game-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        .final-game-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .prize-display {
            font-size: 2rem;
            font-weight: bold;
            margin: 20px 0;
            padding: 20px;
            background: rgba(46, 204, 113, 0.3);
            border-radius: 12px;
            border: 2px solid var(--success);
        }
        .player-turn {
            font-size: 1.3rem;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .final-timer {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 20px 0;
            padding: 20px;
            background: rgba(231, 76, 60, 0.3);
            border-radius: 12px;
            border: 2px solid var(--danger);
        }
        .letter-reveal {
            font-size: 1.8rem;
            margin: 15px 0;
            padding: 15px;
            background: rgba(52, 152, 219, 0.3);
            border-radius: 10px;
            border: 1px solid var(--info);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .game-layout {
                flex-direction: column;
                gap: 10px;
            }
            .team-sidebar {
                flex: 0 0 auto;
                min-height: 200px;
            }
            .team-setup {
                flex-direction: column;
                align-items: center;
            }
            .word {
                font-size: 2.5rem;
            }
            .timer {
                font-size: 2.5rem;
                padding: 12px 25px;
            }
            .seconds-label {
                font-size: 1.2rem;
            }
            .stats-container {
                gap: 10px;
            }
            .stat-box {
                min-width: 110px;
                padding: 10px;
            }
            .stat-label {
                font-size: 0.8rem;
            }
            .stat-value {
                font-size: 1.3rem;
            }
            .final-game-title {
                font-size: 2rem;
            }
            .final-game-subtitle {
                font-size: 1.2rem;
            }
            .chain-word {
                font-size: 1.2rem;
                padding: 12px;
            }
            .final-game-btn {
                padding: 12px 20px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Schermata di Setup -->
    <div class="container setup-screen" id="setupScreen">
        <header>
            <h1>ðŸŽ¯ INTESA VINCENTE</h1>
            <p class="subtitle">3 passi per squadra - 2 raddoppi. Inizia sempre Squadra A.</p>
        </header>
      
        <div class="team-setup">
            <div class="team-input">
                <h3><i class="fas fa-users"></i> SQUADRA A</h3>
                <input type="text" id="teamAName" placeholder="Nome Squadra A" value="Squadra A">
                <div class="player-input">
                    <input type="text" id="teamAPlayerInput" placeholder="Nome giocatore">
                    <button class="add-player-btn" id="addTeamAPlayer"><i class="fas fa-plus"></i></button>
                </div>
                <div class="player-list" id="teamAPlayerList"></div>
                <div class="money-input">
                    <div style="font-size: 1rem; margin-top: 10px;">
                        <i class="fas fa-money-bill-wave"></i> Soldi iniziali Squadra A (â‚¬):
                    </div>
                    <input type="number" id="teamAMoney" placeholder="Inserisci importo in â‚¬" value="0">
                </div>
            </div>
          
            <div class="team-input">
                <h3><i class="fas fa-users"></i> SQUADRA B</h3>
                <input type="text" id="teamBName" placeholder="Nome Squadra B" value="Squadra B">
                <div class="player-input">
                    <input type="text" id="teamBPlayerInput" placeholder="Nome giocatore">
                    <button class="add-player-btn" id="addTeamBPlayer"><i class="fas fa-plus"></i></button>
                </div>
                <div class="player-list" id="teamBPlayerList"></div>
                <div class="money-input">
                    <div style="font-size: 1rem; margin-top: 10px;">
                        <i class="fas fa-money-bill-wave"></i> Soldi iniziali Squadra B (â‚¬):
                    </div>
                    <input type="number" id="teamBMoney" placeholder="Inserisci importo in â‚¬" value="0">
                </div>
            </div>
        </div>
      
        <button class="start-btn" id="startGameBtn" style="padding: 15px 30px; margin: 0 auto;">
            <i class="fas fa-play-circle"></i> INIZIA IL GIOCO
        </button>
    </div>
    <!-- Schermata di Gioco -->
    <div class="container hidden" id="gameScreen">
        <header>
            <h1>ðŸŽ¯ INTESA VINCENTE</h1>
            <!-- Rimosso il round-info dall'header -->
        </header>
      
        <div class="game-layout">
            <!-- Squadra A -->
            <div class="team-sidebar" id="teamASidebar">
                <div class="team-name" id="displayTeamA"><i class="fas fa-users"></i> Squadra A</div>
                <div class="score" id="scoreA">0 Punti</div>
                <div class="money" id="moneyA">â‚¬0</div>
                <div class="players-list" id="teamAPlayersList"></div>
            </div>
          
            <!-- Area Centrale di Gioco -->
            <div class="game-center">
                <div class="timer-section">
                    <div class="timer" id="timer">
                        <span>60</span>
                        <span class="seconds-label">SECONDI</span>
                    </div>
                    <div class="stats-container" id="statsContainer">
                        <div class="stat-box">
                            <div class="stat-label">PASSI UTILIZZATI</div>
                            <div class="stat-value" id="passiUtilizzati">0</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">PASSI RESTANTI</div>
                            <div class="stat-value" id="passiRestanti">3</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">RADDOPPI UTILIZZATI</div>
                            <div class="stat-value" id="raddoppiUtilizzati">0</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">RADDOPPI RESTANTI</div>
                            <div class="stat-value" id="raddoppiRestanti">2</div>
                        </div>
                    </div>
                </div>
              
                <div class="word-display">
                    <div class="word hidden" id="currentWord">PAROLA</div>
                </div>
              
                <div class="controls">
                    <button class="start-btn" id="startTurnBtn">
                        <i class="fas fa-play"></i> INIZIA
                    </button>
                    <button class="stop-btn" id="stopTimerBtn" disabled>
                        <i class="fas fa-pause"></i> STOP
                    </button>
                    <button class="raddoppio-btn" id="raddoppioBtn" disabled>
                        <i class="fas fa-bolt"></i> RADDOPPIA
                    </button>
                    <button class="next-btn" id="passoBtn" disabled>
                        <i class="fas fa-forward"></i> PASSO
                    </button>
                </div>
              
                <div class="answer-controls hidden" id="answerControls">
                    <div class="answering-player" id="answeringPlayer">
                        <i class="fas fa-user"></i> Risponde: Squadra A
                    </div>
                    <div style="display: flex; gap: 15px;">
                        <button class="correct-btn" id="correctBtn">
                            <i class="fas fa-check"></i> ESATTA
                        </button>
                        <button class="wrong-btn" id="wrongBtn">
                            <i class="fas fa-times"></i> ERRATA
                        </button>
                    </div>
                </div>
            </div>
          
            <!-- Squadra B -->
            <div class="team-sidebar" id="teamBSidebar">
                <div class="team-name" id="displayTeamB"><i class="fas fa-users"></i> Squadra B</div>
                <div class="score" id="scoreB">0 Punti</div>
                <div class="money" id="moneyB">â‚¬0</div>
                <div class="players-list" id="teamBPlayersList"></div>
            </div>
        </div>
    </div>
    <!-- Schermata Risultati -->
    <div class="results-screen hidden" id="resultsScreen">
        <div class="results-content">
            <div class="results-title" id="resultsTitle"><i class="fas fa-trophy"></i> RISULTATI SQUADRA A</div>
          
            <div style="font-size: 1.3rem; margin-bottom: 20px;">
                Punti totalizzati in questo passo:
            </div>
          
            <div class="results-points" id="resultsPoints">0</div>
          
            <div class="money-calculation" id="moneyCalculation">
                <i class="fas fa-calculator"></i> Calcolo: 0 punti Ã— â‚¬2.000 = â‚¬0
            </div>
          
            <div class="total-money" id="totalMoney"><i class="fas fa-coins"></i> TOTALE: â‚¬0</div>
          
            <button class="start-btn" id="continueBtn" style="padding: 15px 40px; font-size: 1.2rem; margin-top: 20px;">
                <i class="fas fa-arrow-right"></i> AVANTI
            </button>
          
            <button class="menu-btn" id="menuBtn" style="padding: 12px 30px; font-size: 1.1rem; display: none;">
                <i class="fas fa-trophy"></i> VAI AL GIOCO FINALE
            </button>
        </div>
    </div>
    
    <!-- Schermata Gioco Finale -->
    <div class="final-game-screen hidden" id="finalGameScreen">
        <div class="final-game-content">
            <div class="final-game-title">
                <i class="fas fa-trophy"></i> REAZIONE A CATENA
            </div>
            
            <div class="final-game-subtitle">
                La squadra <span id="winningTeamName">VINCITRICE</span> accede al gioco finale!
            </div>
            
            <div class="final-game-info">
                <p><strong>Regole del gioco:</strong></p>
                <p>La catena Ã¨ composta da 13 parole. Sono visibili le parole in posizione dispari (1Âª, 3Âª, 5Âª, ...).</p>
                <p>Dovete indovinare le 6 parole nascoste in posizione pari (2Âª, 4Âª, 6Âª, ...).</p>
                <p>Ogni errore dimezza il montepremi. Avete 2 jolly a disposizione.</p>
            </div>
            
            <div class="prize-display" id="finalPrizeDisplay">
                Montepremi attuale: <span id="currentPrize">100</span>%
            </div>
            
            <div class="player-turn" id="playerTurnDisplay">
                Turno di: <span id="currentPlayer">Giocatore 1</span>
            </div>
            
            <div class="chain-display" id="chainDisplay">
                <!-- Le parole della catena verranno inserite qui dinamicamente -->
            </div>
            
            <div class="letter-reveal" id="letterRevealDisplay">
                Lettere rivelate: <span id="revealedLetters">X</span>
            </div>
            
            <div class="final-timer" id="finalTimer">
                20
            </div>
            
            <div class="final-game-controls">
                <button class="final-start-btn" id="finalStartBtn">
                    <i class="fas fa-play"></i> INIZIA
                </button>
                <button class="final-jolly-btn" id="finalJollyBtn" disabled>
                    <i class="fas fa-star"></i> USA JOLLY (<span id="jollyCount">2</span>)
                </button>
                <button class="final-answer-btn" id="finalAnswerBtn" disabled>
                    <i class="fas fa-bullhorn"></i> RISPOSTA
                </button>
                <button class="final-next-btn" id="finalNextBtn" disabled>
                    <i class="fas fa-forward"></i> PROSSIMA
                </button>
            </div>
        </div>
    </div>

    <script>
        // Variabili globali
        let teamAPlayers = [];
        let teamBPlayers = [];
        let puntiA = 0;
        let puntiB = 0;
        let teamAMoney = 0;
        let teamBMoney = 0;
        let currentTeam = 'A';
        let teamA_completedRounds = 0;
        let teamB_completedRounds = 0;
        let totalPassi = 3;
        let teamA_passiUtilizzati = 0;
        let teamB_passiUtilizzati = 0;
        let teamA_raddoppiUtilizzati = 0;
        let teamB_raddoppiUtilizzati = 0;
        let maxPassi = 3;
        let maxRaddoppi = 2;
        let timeLeft = 60;
        let timerInterval;
        let gameActive = false;
        let normalWordIndex = 0;
        let doubleWordIndex = 0;
        let puntiTotalizzati = 0;
        let isRaddoppioAttivo = false;
        let raddoppioPerParola = false;
        let gameCompleted = false;
        let availableWords = [];
        let availableDoubleWords = [];
        
        // Variabili per il gioco finale
        let finalGameActive = false;
        let finalChainWords = [];
        let finalHiddenWords = [];
        let finalCurrentWordIndex = 1; // Inizia dalla seconda parola (posizione 2)
        let finalPrizePercentage = 100;
        let finalJollyCount = 2;
        let finalCurrentPlayerIndex = 0;
        let finalRevealedLetters = [];
        let finalTimerInterval;
        let finalTimeLeft = 20;
        let winningTeam = '';
        let winningTeamPlayers = [];
        
        // Database di parole - PAROLE SINGOLE (espanso per maggiore varietÃ )
        const words = [
            "LAMPADINA", "TRENO", "PIZZA", "CANE", "OMBRELLO",
            "SOLDATO", "MARE", "COMPUTER", "DOTTORE", "LUNA",
            "MARTELLO", "CHITARRA", "SCUOLA", "BAMBINO", "CAFFÃˆ",
            "AEREO", "SCARPE", "GIARDINO", "LEONE", "TAVOLO",
            "GELATO", "TELEFONO", "OROLOGIO", "NUVOLA", "BIBLIOTECA",
            "CAVALLO", "SCIMMIA", "SPAZZOLINO", "FORNO", "CALCIO",
            "SPIAGGIA", "MURO", "ALBERO", "SALE", "PESCE",
            "BICICLETTA", "PANTALONI", "DINOSAURO", "PALESTRA", "RAGNO",
            "DENTISTA", "FINESTRA", "FIUME", "LAMPIONE", "ZAINO",
            "CUSCINO", "VENTO", "PORTA", "SEDIA", "TOPO",
            "CHIESA", "SABBIA", "SPECCHIO", "FIORE", "TIGRE",
            "CAMINO", "LATTE", "OCCHIALI", "SASSO", "VULCANO",
            "COCOMERO", "BOTTIGLIA", "CHIODO", "NEVE", "PIANOFORTE",
            "TELEVISORE", "LIBRO", "FARFALLA", "CANDELA", "CAVOLFIORE",
            "SCOPA", "TARTARUGA", "CIELO", "TRAMONTO", "PIPISTRELLO",
            "ZEBRA", "MACCHINA", "TAPPETO", "ZUCCHERO", "ARANCIA",
            "BICCHIERE", "SCARAFAGGIO", "APE", "MONTE", "RISTORANTE",
            "CAROTA", "TENDA", "SQUALO", "BANDIERA", "CORDA",
            "CIGNO", "VALIGIA", "TESCHIO", "MEDAGLIA", "PIUMA",
            "TORRE", "SERPENTE", "FERRO", "CUORE", "CARTA",
            "FUNGO", "QUADERNO", "PENNA", "MATITA", "GOMMA",
            "RIGHELLO", "COMPASSO", "ZUCCA", "MELONE", "PERA",
            "BANANA", "KIWI", "LIMONE", "MELA", "PESCA",
            "ALBICOCCA", "CILIEGIA", "FRAGOLA", "LAMPO", "TUONO",
            "PIOGGIA", "SOLE", "STELLA", "STELLA", "PIANETA", "GALASSIA"
        ];
        // Database di frasi doppie per i raddoppi (espanso)
        const doublePhrases = [
            "CAVALLO MARINO", "CARTA IGIENICA", "TELEFONO FISSO", "ACQUA CALDA",
            "LETTO MATRIMONIALE", "OCCHIALI DA SOLE", "PORTA FINESTRA", "SPAZZOLINO DENTI",
            "ASCIUGA CAPELLI", "FRIGO BAR", "TRENO MERCI", "MACCHINA FOTOGRAFICA",
            "TAVOLO PRANZO", "BORSA TERMICA", "GIACCA VENTO", "AEREO LINEA",
            "CANE CACCIA", "PESCE SPADA", "POMODORO SECCO", "CAPPELLO SOLE",
            "FINESTRA APERTA", "SCATOLA NERA", "PUNTO LUCE", "OROLOGIO POLSO",
            "SCARPE GINNASTICA", "ZAINO MONTAGNA", "LETTERA AMORE", "SEDIA PIEGHEVOLE",
            "LAGO ARTIFICIALE", "MARE APERTO", "MANO DESTRA", "PIANETA TERRA",
            "LAMPADA TAVOLO", "PIUMONE MATRIMONIALE", "FERRO STIRO", "TORTA CIOCCOLATO",
            "MELA VERDE", "CANE LUPO", "FIUME PO", "SALE GROSSO",
            "PEPE NERO", "CARTA PARATI", "CALCIO ANGOLO", "BANDIERA ITALIANA",
            "SCARPA SINISTRA", "PIANO BAR", "LIBRO GIALLO", "BICCHIERE VINO",
            "TENDA CAMPEGGIO", "FINESTRA CHIUSA", "MACCHINA SCRIVERE", "RADIO PORTATILE",
            "FILO SPINATO", "CACCIAVITE CROCE", "CAPPOTTO LUNGO", "BUSTA PAGA",
            "TRENO ALTA", "AEREO CACCIA", "VINO ROSSO", "BIRRA ARTIGIANALE",
            "ACQUA MINERALE", "PANE INTEGRALE", "OLIO OLIVA", "ZUCCHERO VELO",
            "CAFFÃˆ MACCHIATO", "LATTE CALDO", "UOVO SODO", "FORMAGGIO STAGIONATO",
            "CAVOLO CAPPUCCIO", "PATATA FRITTA", "PESCE ROSSO", "LAMPIONE STRADA",
            "SCUOLA ELEMENTARE", "CASA EDITRICE", "CINEMA APERTO", "TEATRO COMUNALE",
            "CENTRO COMMERCIALE", "CAMPO CALCIO", "STADIO OLIMPICO", "AUTO EPOCA",
            "CAMICIA BIANCA", "PANTALONE CORTO", "GONNA LUNGA", "SCARPA TACCO",
            "ZAINO SCOLASTICO", "PORTAFOGLIO VUOTO", "SPECCHIO RETROVISORE", "CHIAVE INGLESE",
            "TAPPETO ROSSO", "DIVANO LETTO", "CUSCINO DECORATIVO", "QUADRO MODERNO",
            "CORNICE DORATA", "LIBRERIA MURO", "TELEFONO CELLULARE", "COMPUTER PORTATILE",
            "MOUSE WIRELESS", "STAMPANTE LASER", "BOTTIGLIA ACQUA", "BIGLIETTO VISITA",
            "PORTA CHIAVI", "PORTA USB", "CAVO ELETTRICO", "BATTERIA AUTO",
            "RUOTA BICICLETTA", "VOLANTE MACCHINA", "FRENO MANO", "CAMBIO MARCIA",
            "SEDILE PASSEGGERO", "CRUSCOTTO AUTO"
        ];
        
        // Catene per il gioco finale
        const finalChains = [
            {
                words: ["SOLE", "CALDO", "ESTATE", "VACANZA", "SPIAGGIA", "MARE", "ONDA", "SURF", "SPORT", "COMPETIZIONE", "VINCITORE", "PREMIO", "FELICITÃ€"],
                hiddenWords: [1, 3, 5, 7, 9, 11] // Indici delle parole nascoste (posizioni pari)
            },
            {
                words: ["LIBRO", "PAGINA", "LETTURA", "CONOSCENZA", "UNIVERSITÃ€", "LAUREA", "CERIMONIA", "FESTA", "AMICI", "ALLEGRIA", "RICORDO", "FOTOGRAFIA", "IMMAGINE"],
                hiddenWords: [1, 3, 5, 7, 9, 11]
            },
            {
                words: ["NOTTE", "STELLA", "CIELO", "LUNA", "MARE", "NAVIGAZIONE", "VIAGGIO", "AVVENTURA", "SCOPERTA", "TESORO", "RICCHEZZA", "FELICITÃ€", "SUCCESSO"],
                hiddenWords: [1, 3, 5, 7, 9, 11]
            }
        ];
        
        // Elementi DOM
        const setupScreen = document.getElementById('setupScreen');
        const gameScreen = document.getElementById('gameScreen');
        const resultsScreen = document.getElementById('resultsScreen');
        const finalGameScreen = document.getElementById('finalGameScreen');
        const timerDisplay = document.getElementById('timer');
        const currentWordDisplay = document.getElementById('currentWord');
        const resultsPoints = document.getElementById('resultsPoints');
        const resultsTitle = document.getElementById('resultsTitle');
        const totalMoney = document.getElementById('totalMoney');
        const moneyCalculation = document.getElementById('moneyCalculation');
        const continueBtn = document.getElementById('continueBtn');
        const menuBtn = document.getElementById('menuBtn');
        
        // Elementi DOM per il gioco finale
        const winningTeamName = document.getElementById('winningTeamName');
        const finalPrizeDisplay = document.getElementById('currentPrize');
        const playerTurnDisplay = document.getElementById('currentPlayer');
        const chainDisplay = document.getElementById('chainDisplay');
        const letterRevealDisplay = document.getElementById('revealedLetters');
        const finalTimer = document.getElementById('finalTimer');
        const finalStartBtn = document.getElementById('finalStartBtn');
        const finalJollyBtn = document.getElementById('finalJollyBtn');
        const finalAnswerBtn = document.getElementById('finalAnswerBtn');
        const finalNextBtn = document.getElementById('finalNextBtn');
        const jollyCount = document.getElementById('jollyCount');
        
        // Setup giocatori
        document.getElementById('addTeamAPlayer').addEventListener('click', () => addPlayer('A'));
        document.getElementById('addTeamBPlayer').addEventListener('click', () => addPlayer('B'));
        document.getElementById('startGameBtn').addEventListener('click', startGame);
        continueBtn.addEventListener('click', continueToNext);
        menuBtn.addEventListener('click', startFinalGameScreen);
        
        // Event listeners per il gioco finale
        finalStartBtn.addEventListener('click', startFinalGame);
        finalJollyBtn.addEventListener('click', useJolly);
        finalAnswerBtn.addEventListener('click', showAnswerInput);
        finalNextBtn.addEventListener('click', nextFinalWord);
        
        function addPlayer(team) {
            const input = document.getElementById(`team${team}PlayerInput`);
            const list = document.getElementById(`team${team}PlayerList`);
            const playerName = input.value.trim();
          
            if (playerName) {
                const players = team === 'A' ? teamAPlayers : teamBPlayers;
                players.push(playerName);
                updatePlayerList(team);
                input.value = '';
            }
        }
        
        function removePlayer(team, index) {
            const players = team === 'A' ? teamAPlayers : teamBPlayers;
            players.splice(index, 1);
            updatePlayerList(team);
        }
        
        function updatePlayerList(team) {
            const list = document.getElementById(`team${team}PlayerList`);
            const players = team === 'A' ? teamAPlayers : teamBPlayers;
          
            list.innerHTML = '';
            players.forEach((player, index) => {
                const playerItem = document.createElement('div');
                playerItem.className = 'player-list-item';
                playerItem.innerHTML = `
                    <span><i class="fas fa-user"></i> ${player}</span>
                    <button class="remove-player-btn" onclick="removePlayer('${team}', ${index})"><i class="fas fa-times"></i></button>
                `;
                list.appendChild(playerItem);
            });
        }
        
        function startGame() {
            // Aggiorna nomi squadre
            document.getElementById('displayTeamA').textContent = document.getElementById('teamAName').value;
            document.getElementById('displayTeamB').textContent = document.getElementById('teamBName').value;
          
            // Salva soldi iniziali
            teamAMoney = parseInt(document.getElementById('teamAMoney').value) || 0;
            teamBMoney = parseInt(document.getElementById('teamBMoney').value) || 0;
          
            // Aggiorna liste giocatori
            updatePlayersInSidebars();
          
            // Passa alla schermata di gioco
            setupScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
          
            // Inizializza il gioco
            initGame();
        }
        
        function updatePlayersInSidebars() {
            updatePlayersInSidebar('teamAPlayersList', teamAPlayers);
            updatePlayersInSidebar('teamBPlayersList', teamBPlayers);
        }
        
        function updatePlayersInSidebar(elementId, players) {
            const element = document.getElementById(elementId);
            element.innerHTML = '';
            players.forEach(player => {
                const playerItem = document.createElement('div');
                playerItem.className = 'player-item';
                playerItem.innerHTML = `<i class="fas fa-user"></i> ${player}`;
                element.appendChild(playerItem);
            });
        }
        
        function initGame() {
            // Mescola le parole una volta sola all'inizio del gioco
            shuffleWords();
          
            updatePunti();
            updateMoney();
            updateActiveTeam();
            updateStats();
            currentWordDisplay.classList.add('hidden');
            puntiTotalizzati = 0;
            isRaddoppioAttivo = false;
            raddoppioPerParola = false;
            gameCompleted = false;
            teamA_completedRounds = 0;
            teamB_completedRounds = 0;
            teamA_passiUtilizzati = 0;
            teamB_passiUtilizzati = 0;
            teamA_raddoppiUtilizzati = 0;
            teamB_raddoppiUtilizzati = 0;
            normalWordIndex = 0;
            doubleWordIndex = 0;
        }
        
        function shuffleWords() {
            // Mescola le parole singole
            availableWords = [...words];
            for (let i = availableWords.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [availableWords[i], availableWords[j]] = [availableWords[j], availableWords[i]];
            }
          
            // Mescola le parole doppie
            availableDoubleWords = [...doublePhrases];
            for (let i = availableDoubleWords.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [availableDoubleWords[i], availableDoubleWords[j]] = [availableDoubleWords[j], availableDoubleWords[i]];
            }
        }
        
        function updateActiveTeam() {
            document.getElementById('teamASidebar').classList.remove('active');
            document.getElementById('teamBSidebar').classList.remove('active');
          
            if (currentTeam === 'A') {
                document.getElementById('teamASidebar').classList.add('active');
            } else {
                document.getElementById('teamBSidebar').classList.add('active');
            }
          
            document.getElementById('answeringPlayer').innerHTML = `<i class="fas fa-user"></i> Risponde: ${currentTeam === 'A' ? document.getElementById('displayTeamA').textContent : document.getElementById('displayTeamB').textContent}`;
        }
        
        function updatePunti() {
            document.getElementById('scoreA').textContent = `${puntiA} Punti`;
            document.getElementById('scoreB').textContent = `${puntiB} Punti`;
        }
        
        function updateMoney() {
            document.getElementById('moneyA').textContent = `â‚¬${teamAMoney.toLocaleString()}`;
            document.getElementById('moneyB').textContent = `â‚¬${teamBMoney.toLocaleString()}`;
        }
        
        function updateStats() {
            const passiUtilizzati = currentTeam === 'A' ? teamA_passiUtilizzati : teamB_passiUtilizzati;
            const raddoppiUtilizzati = currentTeam === 'A' ? teamA_raddoppiUtilizzati : teamB_raddoppiUtilizzati;
            document.getElementById('passiUtilizzati').textContent = passiUtilizzati;
            document.getElementById('passiRestanti').textContent = Math.max(0, maxPassi - passiUtilizzati);
            document.getElementById('raddoppiUtilizzati').textContent = raddoppiUtilizzati;
            document.getElementById('raddoppiRestanti').textContent = Math.max(0, maxRaddoppi - raddoppiUtilizzati);
        }
        
        function showNextWord() {
            if (isRaddoppioAttivo && raddoppioPerParola) {
                if (doubleWordIndex < availableDoubleWords.length) {
                    currentWordDisplay.textContent = availableDoubleWords[doubleWordIndex++];
                } else {
                    currentWordDisplay.textContent = "FINE PAROLE DOPPIE";
                    endTurn();
                    return;
                }
            } else {
                if (normalWordIndex < availableWords.length) {
                    currentWordDisplay.textContent = availableWords[normalWordIndex++];
                } else {
                    currentWordDisplay.textContent = "FINE PAROLE";
                    endTurn();
                    return;
                }
            }
          
            currentWordDisplay.classList.remove('hidden');
        }
        
        // Controlli di gioco
        document.getElementById('startTurnBtn').addEventListener('click', startTurn);
        document.getElementById('stopTimerBtn').addEventListener('click', stopTimer);
        document.getElementById('raddoppioBtn').addEventListener('click', attivaRaddoppio);
        document.getElementById('passoBtn').addEventListener('click', usaPasso);
        document.getElementById('correctBtn').addEventListener('click', handleCorrectAnswer);
        document.getElementById('wrongBtn').addEventListener('click', handleWrongAnswer);
        
        function startTurn() {
            if (gameActive) return;
          
            gameActive = true;
            timeLeft = 60;
            timerDisplay.querySelector('span').textContent = timeLeft;
            puntiTotalizzati = 0;
            isRaddoppioAttivo = false;
            raddoppioPerParola = false;
          
            document.getElementById('startTurnBtn').disabled = true;
            document.getElementById('stopTimerBtn').disabled = false;
            document.getElementById('raddoppioBtn').disabled = false;
            document.getElementById('passoBtn').disabled = false;
            document.getElementById('answerControls').classList.add('hidden');
          
            showNextWord();
            startTimer();
        }
        
        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                timerDisplay.querySelector('span').textContent = timeLeft;
              
                if (timeLeft <= 0) {
                    endTurn();
                }
            }, 1000);
        }
        
        function stopTimer() {
            if (!gameActive) return;
          
            clearInterval(timerInterval);
            document.getElementById('answerControls').classList.remove('hidden');
            document.getElementById('stopTimerBtn').disabled = true;
            document.getElementById('raddoppioBtn').disabled = true;
            document.getElementById('passoBtn').disabled = true;
        }
        
        function attivaRaddoppio() {
            const raddoppiUtilizzati = currentTeam === 'A' ? teamA_raddoppiUtilizzati : teamB_raddoppiUtilizzati;
            if (!gameActive || isRaddoppioAttivo || raddoppiUtilizzati >= maxRaddoppi) return;
          
            isRaddoppioAttivo = true;
            raddoppioPerParola = true;
            if (currentTeam === 'A') {
                teamA_raddoppiUtilizzati++;
            } else {
                teamB_raddoppiUtilizzati++;
            }
            document.getElementById('raddoppioBtn').disabled = true;
            document.getElementById('raddoppioBtn').innerHTML = '<i class="fas fa-bolt"></i> RADDOPPIO ATTIVO';
            updateStats();
          
            // Mostra subito una parola doppia
            showNextWord();
        }
        
        function usaPasso() {
            const passiUtilizzati = currentTeam === 'A' ? teamA_passiUtilizzati : teamB_passiUtilizzati;
            if (!gameActive || passiUtilizzati >= maxPassi) return;
          
            if (currentTeam === 'A') {
                teamA_passiUtilizzati++;
            } else {
                teamB_passiUtilizzati++;
            }
            updateStats();
          
            // Se abbiamo usato tutti i passi, disabilita il pulsante
            if ((currentTeam === 'A' ? teamA_passiUtilizzati : teamB_passiUtilizzati) >= maxPassi) {
                document.getElementById('passoBtn').disabled = true;
            }
          
            // Passa alla parola successiva
            showNextWord();
        }
        
        function handleCorrectAnswer() {
            const punti = isRaddoppioAttivo && raddoppioPerParola ? 2 : 1;
            puntiTotalizzati += punti;
          
            if (currentTeam === 'A') {
                puntiA += punti;
            } else {
                puntiB += punti;
            }
          
            // Disattiva il raddoppio dopo una risposta corretta
            if (isRaddoppioAttivo && raddoppioPerParola) {
                isRaddoppioAttivo = false;
                raddoppioPerParola = false;
                document.getElementById('raddoppioBtn').innerHTML = '<i class="fas fa-bolt"></i> RADDOPPIA';
            }
          
            updatePunti();
            document.getElementById('answerControls').classList.add('hidden');
            document.getElementById('stopTimerBtn').disabled = false;
            document.getElementById('raddoppioBtn').disabled = false;
            document.getElementById('passoBtn').disabled = false;
          
            showNextWord();
            startTimer();
        }
        
        function handleWrongAnswer() {
            const punti = isRaddoppioAttivo && raddoppioPerParola ? 2 : 1;
          
            // Non si puÃ² andare sotto lo 0
            if (currentTeam === 'A' && puntiA >= punti) {
                puntiA -= punti;
                puntiTotalizzati -= punti;
            } else if (currentTeam === 'B' && puntiB >= punti) {
                puntiB -= punti;
                puntiTotalizzati -= punti;
            }
          
            // Disattiva il raddoppio dopo una risposta errata
            if (isRaddoppioAttivo && raddoppioPerParola) {
                isRaddoppioAttivo = false;
                raddoppioPerParola = false;
                document.getElementById('raddoppioBtn').innerHTML = '<i class="fas fa-bolt"></i> RADDOPPIA';
            }
          
            updatePunti();
            document.getElementById('answerControls').classList.add('hidden');
            document.getElementById('stopTimerBtn').disabled = false;
            document.getElementById('raddoppioBtn').disabled = false;
            document.getElementById('passoBtn').disabled = false;
          
            showNextWord();
            startTimer();
        }
        
        function endTurn() {
            clearInterval(timerInterval);
            gameActive = false;
          
            document.getElementById('startTurnBtn').disabled = false;
            document.getElementById('stopTimerBtn').disabled = true;
            document.getElementById('raddoppioBtn').disabled = true;
            document.getElementById('passoBtn').disabled = true;
            document.getElementById('answerControls').classList.add('hidden');
            currentWordDisplay.classList.add('hidden');
          
            // Incrementa i round completati per la squadra corrente
            if (currentTeam === 'A') {
                teamA_completedRounds++;
            } else {
                teamB_completedRounds++;
            }
          
            // Mostra schermata risultati
            showResults();
        }
        
        function showResults() {
            const teamName = currentTeam === 'A' ? document.getElementById('displayTeamA').textContent : document.getElementById('displayTeamB').textContent;
            resultsTitle.textContent = `RISULTATI ${teamName}`;
            resultsPoints.textContent = puntiTotalizzati;
          
            // Calcola i soldi precedenti in base ai punti
            const previousMoney = currentTeam === 'A' ? teamAMoney : teamBMoney;
            const newMoney = puntiTotalizzati * 2000;
            const total = previousMoney + newMoney;
          
            moneyCalculation.textContent = `Calcolo: ${puntiTotalizzati} punti Ã— â‚¬2.000 = â‚¬${newMoney.toLocaleString()}`;
            totalMoney.textContent = `TOTALE: â‚¬${total.toLocaleString()}`;
          
            // Controlla se il gioco Ã¨ completato
            gameCompleted = (teamA_completedRounds === 3 && teamB_completedRounds === 3);
            if (gameCompleted) {
                continueBtn.style.display = 'none';
                menuBtn.style.display = 'block';
                resultsTitle.innerHTML = `<i class="fas fa-flag-checkered"></i> GIOCO COMPLETATO`;
                
                // Determina la squadra vincente
                determineWinningTeam();
                
                // Cambia il testo del pulsante per andare al gioco finale
                menuBtn.innerHTML = `<i class="fas fa-trophy"></i> VAI AL GIOCO FINALE`;
                menuBtn.onclick = startFinalGameScreen;
            } else {
                continueBtn.style.display = 'block';
                menuBtn.style.display = 'none';
            }
          
            gameScreen.classList.add('hidden');
            resultsScreen.classList.remove('hidden');
        }
        
        function determineWinningTeam() {
            // Determina la squadra con piÃ¹ punti
            if (puntiA > puntiB) {
                winningTeam = 'A';
                winningTeamPlayers = teamAPlayers;
            } else if (puntiB > puntiA) {
                winningTeam = 'B';
                winningTeamPlayers = teamBPlayers;
            } else {
                // In caso di pareggio, la squadra con piÃ¹ soldi vince
                if (teamAMoney > teamBMoney) {
                    winningTeam = 'A';
                    winningTeamPlayers = teamAPlayers;
                } else if (teamBMoney > teamAMoney) {
                    winningTeam = 'B';
                    winningTeamPlayers = teamBPlayers;
                } else {
                    // In caso di ulteriore pareggio, scegli a caso
                    winningTeam = Math.random() < 0.5 ? 'A' : 'B';
                    winningTeamPlayers = winningTeam === 'A' ? teamAPlayers : teamBPlayers;
                }
            }
        }
        
        function startFinalGameScreen() {
            resultsScreen.classList.add('hidden');
            finalGameScreen.classList.remove('hidden');
            
            // Inizializza il gioco finale
            initFinalGame();
        }
        
        function initFinalGame() {
            finalGameActive = false;
            
            // Seleziona una catena casuale
            const randomChainIndex = Math.floor(Math.random() * finalChains.length);
            const selectedChain = finalChains[randomChainIndex];
            finalChainWords = selectedChain.words;
            finalHiddenWords = selectedChain.hiddenWords;
            
            // Inizializza le variabili di gioco
            finalCurrentWordIndex = 1; // Inizia dalla seconda parola (posizione 2)
            finalPrizePercentage = 100;
            finalJollyCount = 2;
            finalCurrentPlayerIndex = 0;
            finalRevealedLetters = [];
            
            // Inizializza le lettere rivelate per ogni parola nascosta
            for (let i = 0; i < finalHiddenWords.length; i++) {
                finalRevealedLetters[i] = [0]; // Solo la prima lettera inizialmente
            }
            
            // Aggiorna l'interfaccia
            updateFinalGameUI();
            
            // Mostra il nome della squadra vincente
            const winningTeamNameText = winningTeam === 'A' ? 
                document.getElementById('teamAName').value : 
                document.getElementById('teamBName').value;
            winningTeamName.textContent = winningTeamNameText;
        }
        
        function updateFinalGameUI() {
            // Aggiorna il display del premio
            finalPrizeDisplay.textContent = finalPrizePercentage;
            
            // Aggiorna il conteggio dei jolly
            jollyCount.textContent = finalJollyCount;
            
            // Aggiorna il turno del giocatore
            const currentPlayer = winningTeamPlayers[finalCurrentPlayerIndex];
            playerTurnDisplay.textContent = currentPlayer;
            
            // Aggiorna la visualizzazione della catena
            updateChainDisplay();
            
            // Aggiorna le lettere rivelate per la parola corrente
            updateLetterRevealDisplay();
            
            // Aggiorna lo stato dei pulsanti
            finalStartBtn.disabled = finalGameActive;
            finalJollyBtn.disabled = !finalGameActive || finalJollyCount === 0;
            finalAnswerBtn.disabled = !finalGameActive;
            finalNextBtn.disabled = !finalGameActive;
        }
        
        function updateChainDisplay() {
            chainDisplay.innerHTML = '';
            
            for (let i = 0; i < finalChainWords.length; i++) {
                const wordElement = document.createElement('div');
                wordElement.className = 'chain-word';
                
                // Controlla se questa Ã¨ una parola nascosta
                if (finalHiddenWords.includes(i)) {
                    // Ãˆ una parola nascosta
                    const hiddenWordIndex = finalHiddenWords.indexOf(i);
                    
                    if (hiddenWordIndex === finalCurrentWordIndex - 1) {
                        // Parola corrente - mostra le lettere rivelate
                        const revealed = finalRevealedLetters[hiddenWordIndex];
                        const word = finalChainWords[i];
                        let displayText = '';
                        
                        for (let j = 0; j < word.length; j++) {
                            if (revealed.includes(j)) {
                                displayText += word[j];
                            } else {
                                displayText += '_';
                            }
                        }
                        
                        wordElement.textContent = displayText;
                        wordElement.classList.add('partial');
                    } else if (hiddenWordIndex < finalCurrentWordIndex - 1) {
                        // Parola giÃ  indovinata
                        wordElement.textContent = finalChainWords[i];
                        wordElement.classList.add('revealed');
                    } else {
                        // Parola non ancora raggiunta
                        wordElement.textContent = '?';
                        wordElement.classList.add('hidden');
                    }
                } else {
                    // Parola sempre visibile
                    wordElement.textContent = finalChainWords[i];
                    wordElement.classList.add('revealed');
                }
                
                chainDisplay.appendChild(wordElement);
            }
        }
        
        function updateLetterRevealDisplay() {
            if (finalCurrentWordIndex <= finalHiddenWords.length) {
                const hiddenWordIndex = finalCurrentWordIndex - 1;
                const revealed = finalRevealedLetters[hiddenWordIndex];
                const word = finalChainWords[finalHiddenWords[hiddenWordIndex]];
                let displayText = '';
                
                for (let j = 0; j < word.length; j++) {
                    if (revealed.includes(j)) {
                        displayText += word[j];
                    } else {
                        displayText += '_';
                    }
                }
                
                letterRevealDisplay.textContent = displayText;
            } else {
                letterRevealDisplay.textContent = 'Completato!';
            }
        }
        
        function startFinalGame() {
            if (finalGameActive) return;
            
            finalGameActive = true;
            finalTimeLeft = 20;
            finalTimer.textContent = finalTimeLeft;
            
            // Aggiorna l'interfaccia
            updateFinalGameUI();
            
            // Avvia il timer
            startFinalTimer();
        }
        
        function startFinalTimer() {
            clearInterval(finalTimerInterval);
            finalTimerInterval = setInterval(() => {
                finalTimeLeft--;
                finalTimer.textContent = finalTimeLeft;
                
                if (finalTimeLeft <= 0) {
                    clearInterval(finalTimerInterval);
                    handleFinalTimeExpired();
                }
            }, 1000);
        }
        
        function handleFinalTimeExpired() {
            // Tempo scaduto - aggiungi una lettera e passa al giocatore successivo
            revealAdditionalLetter();
            nextPlayer();
            
            // Riprendi il gioco
            finalTimeLeft = 20;
            finalTimer.textContent = finalTimeLeft;
            startFinalTimer();
        }
        
        function useJolly() {
            if (!finalGameActive || finalJollyCount === 0) return;
            
            finalJollyCount--;
            revealAdditionalLetter();
            
            // Aggiorna l'interfaccia
            updateFinalGameUI();
        }
        
        function revealAdditionalLetter() {
            if (finalCurrentWordIndex > finalHiddenWords.length) return;
            
            const hiddenWordIndex = finalCurrentWordIndex - 1;
            const word = finalChainWords[finalHiddenWords[hiddenWordIndex]];
            const revealed = finalRevealedLetters[hiddenWordIndex];
            
            // Trova la prossima lettera non rivelata
            for (let i = 0; i < word.length; i++) {
                if (!revealed.includes(i)) {
                    revealed.push(i);
                    break;
                }
            }
            
            // Aggiorna l'interfaccia
            updateChainDisplay();
            updateLetterRevealDisplay();
        }
        
        function showAnswerInput() {
            if (!finalGameActive) return;
            
            // Ferma il timer
            clearInterval(finalTimerInterval);
            
            // Mostra un prompt per inserire la risposta
            const answer = prompt("Inserisci la parola nascosta:");
            
            if (answer) {
                checkFinalAnswer(answer.toUpperCase());
            } else {
                // Riprendi il timer se non Ã¨ stata data risposta
                startFinalTimer();
            }
        }
        
        function checkFinalAnswer(answer) {
            const hiddenWordIndex = finalCurrentWordIndex - 1;
            const correctWord = finalChainWords[finalHiddenWords[hiddenWordIndex]];
            
            if (answer === correctWord) {
                // Risposta corretta
                alert(`Esatto! La parola Ã¨ "${correctWord}"`);
                
                // Passa alla parola successiva
                finalCurrentWordIndex++;
                
                // Controlla se il gioco Ã¨ finito
                if (finalCurrentWordIndex > finalHiddenWords.length) {
                    endFinalGame(true);
                } else {
                    // Passa al giocatore successivo
                    nextPlayer();
                    
                    // Riprendi il gioco
                    finalTimeLeft = 20;
                    finalTimer.textContent = finalTimeLeft;
                    startFinalTimer();
                    
                    // Aggiorna l'interfaccia
                    updateFinalGameUI();
                }
            } else {
                // Risposta errata - dimezza il premio
                finalPrizePercentage = Math.floor(finalPrizePercentage / 2);
                alert(`Risposta errata! Il montepremi si dimezza. La parola corretta era "${correctWord}"`);
                
                // Aggiungi una lettera
                revealAdditionalLetter();
                
                // Passa al giocatore successivo
                nextPlayer();
                
                // Riprendi il gioco
                finalTimeLeft = 20;
                finalTimer.textContent = finalTimeLeft;
                startFinalTimer();
                
                // Aggiorna l'interfaccia
                updateFinalGameUI();
            }
        }
        
        function nextPlayer() {
            finalCurrentPlayerIndex = (finalCurrentPlayerIndex + 1) % winningTeamPlayers.length;
        }
        
        function nextFinalWord() {
            if (!finalGameActive) return;
            
            // Passa alla parola successiva
            finalCurrentWordIndex++;
            
            // Controlla se il gioco Ã¨ finito
            if (finalCurrentWordIndex > finalHiddenWords.length) {
                endFinalGame(false);
            } else {
                // Passa al giocatore successivo
                nextPlayer();
                
                // Aggiorna l'interfaccia
                updateFinalGameUI();
            }
        }
        
        function endFinalGame(isSuccess) {
            finalGameActive = false;
            clearInterval(finalTimerInterval);
            
            if (isSuccess) {
                alert(`Complimenti! Avete completato la catena e vinto il ${finalPrizePercentage}% del montepremi!`);
            } else {
                alert(`Gioco completato! Avete vinto il ${finalPrizePercentage}% del montepremi.`);
            }
            
            // Torna al menu principale
            finalGameScreen.classList.add('hidden');
            setupScreen.classList.remove('hidden');
            
            // Reset del gioco
            resetGame();
        }
        
        function resetGame() {
            // Reset di tutte le variabili del gioco
            puntiA = 0;
            puntiB = 0;
            teamAMoney = 0;
            teamBMoney = 0;
            currentTeam = 'A';
            teamA_completedRounds = 0;
            teamB_completedRounds = 0;
            teamA_passiUtilizzati = 0;
            teamB_passiUtilizzati = 0;
            teamA_raddoppiUtilizzati = 0;
            teamB_raddoppiUtilizzati = 0;
            gameCompleted = false;
        }
        
        function continueToNext() {
            // Aggiorna i soldi della squadra
            const newMoney = puntiTotalizzati * 2000;
            if (currentTeam === 'A') {
                teamAMoney += newMoney;
            } else {
                teamBMoney += newMoney;
            }
          
            // Cambia squadra
            currentTeam = currentTeam === 'A' ? 'B' : 'A';
          
            // Torna alla schermata di gioco
            resultsScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
          
            // Aggiorna l'interfaccia
            updatePunti();
            updateMoney();
            updateActiveTeam();
            updateStats();
          
            // Aggiorna il testo del pulsante start
            const teamName = currentTeam === 'A' ? document.getElementById('displayTeamA').textContent : document.getElementById('displayTeamB').textContent;
            document.getElementById('startTurnBtn').innerHTML = `<i class="fas fa-play"></i> TOCCA A ${teamName.toUpperCase()} - INIZIA`;
        }
        
        // Inizializzazione
        window.addEventListener('load', () => {
            updatePlayerList('A');
            updatePlayerList('B');
        });
    </script>
</body>
</html>
